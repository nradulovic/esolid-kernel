\hypertarget{cpu_8h}{\subsection{cpu.\-h File Reference}
\label{cpu_8h}\index{cpu.\-h@{cpu.\-h}}
}


Interface of C\-P\-U port -\/ Template.  


{\ttfamily \#include \char`\"{}cpu\-\_\-cfg.\-h\char`\"{}}\\*
Include dependency graph for cpu.\-h\-:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=138pt]{cpu_8h__incl}
\end{center}
\end{figure}
\subsubsection*{Data Structures}
\begin{DoxyCompactItemize}
\item 
struct \hyperlink{structportStck}{port\-Stck}
\begin{DoxyCompactList}\small\item\em Stack structure used for stack declaration in order to force the alignment Alignment of stack structure. \end{DoxyCompactList}\item 
struct \hyperlink{structportCtx}{port\-Ctx}
\begin{DoxyCompactList}\small\item\em Port context structure. \end{DoxyCompactList}\end{DoxyCompactItemize}
\subsubsection*{Macros}
\begin{Indent}{\bf Port constants}\par
\begin{DoxyCompactItemize}
\item 
\#define \hyperlink{group__template__cpu__intf_gac4d9e19c50315dec7721d4bc4d6b0605}{P\-O\-R\-T\-\_\-\-D\-A\-T\-A\-\_\-\-W\-I\-D\-T\-H\-\_\-\-V\-A\-L}~8\-U
\begin{DoxyCompactList}\small\item\em This macro specifies the bit width of C\-P\-U data registers. \end{DoxyCompactList}\item 
\#define \hyperlink{group__template__cpu__intf_ga99f0219f12d2003e4e447fcaa06aa133}{P\-O\-R\-T\-\_\-\-S\-T\-C\-K\-\_\-\-M\-I\-N\-S\-I\-Z\-E\-\_\-\-V\-A\-L}~(sizeof(struct \hyperlink{structportCtx}{port\-Ctx}) / sizeof(\hyperlink{group__template__cpu__intf_ga99980ab56ce9857e7380210d12e3d41f}{port\-Reg\-\_\-\-T}))
\begin{DoxyCompactList}\small\item\em This macro specifies the minimal size of the thread stack. \end{DoxyCompactList}\item 
\#define \hyperlink{group__template__cpu__intf_gaa909258f3d25701e167c8dcb2a004eaf}{P\-O\-R\-T\-\_\-\-S\-Y\-S\-T\-M\-R\-\_\-\-O\-N\-E\-\_\-\-T\-I\-C\-K\-\_\-\-V\-A\-L}~(\hyperlink{group__template__cpu__cfg_gac85c592962ba2c968d13f867533196a1}{C\-F\-G\-\_\-\-S\-Y\-S\-T\-M\-R\-\_\-\-C\-L\-O\-C\-K\-\_\-\-F\-R\-E\-Q\-U\-E\-N\-C\-Y} / \hyperlink{group__template__kern__cfg_ga4e46164ae5a37bfc54c67b6f01d93eb1}{C\-F\-G\-\_\-\-S\-Y\-S\-T\-M\-R\-\_\-\-E\-V\-E\-N\-T\-\_\-\-F\-R\-E\-Q\-U\-E\-N\-C\-Y})
\begin{DoxyCompactList}\small\item\em System timer reload value for one tick. \end{DoxyCompactList}\item 
\#define \hyperlink{group__template__cpu__intf_ga5b8bb3d2476505b4379ca2b87ec22547}{P\-O\-R\-T\-\_\-\-S\-Y\-S\-T\-M\-R\-\_\-\-M\-A\-X\-\_\-\-V\-A\-L}~0x\-F\-F\-U
\begin{DoxyCompactList}\small\item\em System timer maximum value. \end{DoxyCompactList}\item 
\#define \hyperlink{group__template__cpu__intf_gad32a57bda2ce96037186e490b5a024e9}{P\-O\-R\-T\-\_\-\-S\-Y\-S\-T\-M\-R\-\_\-\-M\-A\-X\-\_\-\-T\-I\-C\-K\-S\-\_\-\-V\-A\-L}~(\hyperlink{group__template__cpu__intf_ga5b8bb3d2476505b4379ca2b87ec22547}{P\-O\-R\-T\-\_\-\-S\-Y\-S\-T\-M\-R\-\_\-\-M\-A\-X\-\_\-\-V\-A\-L} / P\-O\-R\-T\-\_\-\-S\-Y\-S\-T\-M\-R\-\_\-\-R\-E\-L\-O\-A\-D\-\_\-\-V\-A\-L)
\begin{DoxyCompactList}\small\item\em Maximum number of ticks the system timer can accept. \end{DoxyCompactList}\item 
\#define \hyperlink{group__template__cpu__intf_ga9f3862a2ded7b9fbb69f982acc020728}{P\-O\-R\-T\-\_\-\-K\-V\-T\-M\-R\-\_\-\-S\-T\-C\-K\-\_\-\-S\-I\-Z\-E}~40\-U
\begin{DoxyCompactList}\small\item\em Kernel Virtual Timer Thread stack size. \end{DoxyCompactList}\item 
\#define \hyperlink{group__template__cpu__intf_ga2cb7ea9e526744b74367bbffda625044}{P\-O\-R\-T\-\_\-\-K\-I\-D\-L\-E\-\_\-\-S\-T\-C\-K\-\_\-\-S\-I\-Z\-E}~40\-U
\begin{DoxyCompactList}\small\item\em Kernel Idle Thread stack size. \end{DoxyCompactList}\end{DoxyCompactItemize}
\end{Indent}
\begin{Indent}{\bf Interrupt management}\par
{\em P\-O\-R\-T\-\_\-\-I\-S\-R\-\_\-... macros are used by es\-Kern\-Isr\-Enter() and es\-Kern\-Isr\-Exit() functions. They are used to keep the current level of I\-S\-R nesting. Scheduler should be invoked only from the last I\-S\-R that is executing. }\begin{DoxyCompactItemize}
\item 
\#define \hyperlink{group__template__cpu__intf_gac73a0b0b3d8a130a8d8283be5bba057d}{P\-O\-R\-T\-\_\-\-I\-N\-T\-\_\-\-D\-I\-S\-A\-B\-L\-E}()
\begin{DoxyCompactList}\small\item\em Disable all interrupt sources. \end{DoxyCompactList}\item 
\#define \hyperlink{group__template__cpu__intf_gaccad9298c874b29753b318d4f900cb75}{P\-O\-R\-T\-\_\-\-I\-S\-R\-\_\-\-E\-N\-T\-E\-R}()
\begin{DoxyCompactList}\small\item\em Enter I\-S\-R. Increment g\-Port\-Isr\-Nesting\-\_\- variable to keep track of I\-S\-R nesting. \end{DoxyCompactList}\item 
\#define \hyperlink{group__template__cpu__intf_ga267c312d7321e9361b454f4274bbc087}{P\-O\-R\-T\-\_\-\-I\-S\-R\-\_\-\-E\-X\-I\-T}()
\begin{DoxyCompactList}\small\item\em Exit I\-S\-R. Decrement g\-Port\-Isr\-Nesting\-\_\- variable to keep track of I\-S\-R nesting. \end{DoxyCompactList}\item 
\#define \hyperlink{group__template__cpu__intf_ga6c0ea20c8e1f6b9751f51916da8e2aee}{P\-O\-R\-T\-\_\-\-I\-S\-R\-\_\-\-I\-S\-\_\-\-L\-A\-S\-T}()~(0\-U == g\-Port\-Isr\-Nesting ? T\-R\-U\-E \-: F\-A\-L\-S\-E)
\begin{DoxyCompactList}\small\item\em If isr\-Nesting variable is zero then the last I\-S\-R is executing and scheduler should be invoked. \end{DoxyCompactList}\end{DoxyCompactItemize}
\end{Indent}
\begin{Indent}{\bf Critical section management}\par
{\em Disable/enable interrupts by preserving the status of interrupts.

Generally speaking these macros would store the status of the interrupt disable flag in the local variable declared by \hyperlink{group__template__cpu__intf_gaecf0dc273d0d77b45baa682e0f2932ab}{P\-O\-R\-T\-\_\-\-C\-R\-I\-T\-I\-C\-A\-L\-\_\-\-D\-E\-C\-L} and then disable interrupts. Local variable is allocated in all of e\-Solid R\-T\-O\-S functions that need to disable interrupts. Macros would restore the interrupt status by copying back the allocated variable into the C\-P\-U's status register. }\begin{DoxyCompactItemize}
\item 
\#define \hyperlink{group__template__cpu__intf_gaecf0dc273d0d77b45baa682e0f2932ab}{P\-O\-R\-T\-\_\-\-C\-R\-I\-T\-I\-C\-A\-L\-\_\-\-D\-E\-C\-L}()~\hyperlink{group__template__cpu__intf_ga99980ab56ce9857e7380210d12e3d41f}{port\-Reg\-\_\-\-T} int\-Status\-\_\-
\begin{DoxyCompactList}\small\item\em Declare the interrupt status variable. \end{DoxyCompactList}\item 
\#define \hyperlink{group__template__cpu__intf_gad230b116bf8bc513e64c533d4e946054}{P\-O\-R\-T\-\_\-\-C\-R\-I\-T\-I\-C\-A\-L\-\_\-\-E\-N\-T\-E\-R}()
\begin{DoxyCompactList}\small\item\em Enter critical section. \end{DoxyCompactList}\item 
\#define \hyperlink{group__template__cpu__intf_ga95082ec189f12ed8e39efbda811dea77}{P\-O\-R\-T\-\_\-\-C\-R\-I\-T\-I\-C\-A\-L\-\_\-\-E\-X\-I\-T}()
\begin{DoxyCompactList}\small\item\em Exit critical section. \end{DoxyCompactList}\end{DoxyCompactItemize}
\end{Indent}
\begin{Indent}{\bf General port macros}\par
\begin{DoxyCompactItemize}
\item 
\#define \hyperlink{group__template__cpu__intf_gacb3a46e89d327fbaf5c122fe23877b24}{P\-O\-R\-T\-\_\-\-S\-T\-C\-K\-\_\-\-S\-I\-Z\-E}(size)
\begin{DoxyCompactList}\small\item\em Calculate the stack size. \end{DoxyCompactList}\item 
\#define \hyperlink{group__template__cpu__intf_gad699a79233d442ae90a69c113e314542}{P\-O\-R\-T\-\_\-\-C\-R\-I\-T\-I\-C\-A\-L\-\_\-\-E\-X\-I\-T\-\_\-\-S\-L\-E\-E\-P}()~port\-Int\-Set\-Sleep\-Enter\-\_\-(int\-Status\-\_\-)
\begin{DoxyCompactList}\small\item\em Exit critical section and enter sleep state. \end{DoxyCompactList}\item 
\#define \hyperlink{group__template__cpu__intf_gac9622b857ad35f73ae92a44a9d0f717c}{P\-O\-R\-T\-\_\-\-I\-N\-I\-T\-\_\-\-E\-A\-R\-L\-Y}()
\begin{DoxyCompactList}\small\item\em Early port initialization. \end{DoxyCompactList}\item 
\#define \hyperlink{group__template__cpu__intf_ga0da077bab2264b11c4107f0bef279b86}{P\-O\-R\-T\-\_\-\-I\-N\-I\-T}()
\begin{DoxyCompactList}\small\item\em Port initialization. \end{DoxyCompactList}\item 
\#define \hyperlink{group__template__cpu__intf_ga8bfda2e0a8029092d0377640ba228b6d}{P\-O\-R\-T\-\_\-\-I\-N\-I\-T\-\_\-\-L\-A\-T\-E}()
\begin{DoxyCompactList}\small\item\em Late port initialization. \end{DoxyCompactList}\item 
\#define \hyperlink{group__template__cpu__intf_gab2a39b200d6e6806896ba45a9c3a9d1e}{P\-O\-R\-T\-\_\-\-T\-E\-R\-M}()
\begin{DoxyCompactList}\small\item\em Terminate port. \end{DoxyCompactList}\end{DoxyCompactItemize}
\end{Indent}
\subsubsection*{Typedefs}
\begin{DoxyCompactItemize}
\item 
typedef uint8\-\_\-t \hyperlink{group__template__cpu__intf_ga99980ab56ce9857e7380210d12e3d41f}{port\-Reg\-\_\-\-T}
\begin{DoxyCompactList}\small\item\em Data type which corresponds to the general purpose register. \end{DoxyCompactList}\item 
typedef struct \hyperlink{structportStck}{port\-Stck} \hyperlink{group__template__cpu__intf_ga13cc91970e3e05fe4210440c068d3f4a}{port\-Stck\-\_\-\-T}
\begin{DoxyCompactList}\small\item\em Stack type. \end{DoxyCompactList}\end{DoxyCompactItemize}
\subsubsection*{Variables}
\begin{DoxyCompactItemize}
\item 
\hyperlink{group__template__cpu__intf_ga99980ab56ce9857e7380210d12e3d41f}{port\-Reg\-\_\-\-T} \hyperlink{group__template__cpu__intf_ga76dd98d1f19ff5ce4b4e880dfcedadb9}{g\-Port\-Isr\-Nesting\-\_\-}
\begin{DoxyCompactList}\small\item\em Variable to keep track of I\-S\-R nesting. \end{DoxyCompactList}\item 
const P\-O\-R\-T\-\_\-\-C\-\_\-\-R\-O\-M \hyperlink{group__template__cpu__intf_ga99980ab56ce9857e7380210d12e3d41f}{port\-Reg\-\_\-\-T} \hyperlink{group__template__cpu__intf_ga7c74d77135d5a694029ce4805f5dbc13}{pwr2\-L\-K\-P} \mbox{[}\hyperlink{group__template__cpu__intf_gac4d9e19c50315dec7721d4bc4d6b0605}{P\-O\-R\-T\-\_\-\-D\-A\-T\-A\-\_\-\-W\-I\-D\-T\-H\-\_\-\-V\-A\-L}\mbox{]}
\begin{DoxyCompactList}\small\item\em Look up table for\-: 2$^\wedge$n expression. \end{DoxyCompactList}\end{DoxyCompactItemize}
\subsubsection*{Scheduler support}
\label{_amgrp4dcdbeafb69eec06b5ccc9a6733244b8}%
\begin{DoxyNote}{Note}
These functions are extensively used by the scheduler and therefore they should be optimized for the architecture being used. 
\end{DoxyNote}
\begin{DoxyCompactItemize}
\item 
\#define \hyperlink{group__template__cpu__intf_ga5574dfe2108fc8a4cf83647113724052}{P\-O\-R\-T\-\_\-\-F\-I\-N\-D\-\_\-\-L\-A\-S\-T\-\_\-\-S\-E\-T}(val)~\hyperlink{group__template__cpu__impl_ga548cbf806bfd34904f60a1f8db0ce965}{port\-Find\-Last\-Set\-\_\-}(val)
\begin{DoxyCompactList}\small\item\em Find last set bit in a word. \end{DoxyCompactList}\item 
\#define \hyperlink{group__template__cpu__intf_ga4b938b55e8398b93969cfb7bc64177cd}{P\-O\-R\-T\-\_\-\-P\-W\-R2}(pwr)~(1\-U $<$$<$ (pwr))
\begin{DoxyCompactList}\small\item\em Helper macro\-: calculate 2$^\wedge$pwr expression. \end{DoxyCompactList}\item 
\#define \hyperlink{group__template__cpu__intf_gae4de1f7cd0b489825c5f3d848211fa01}{P\-O\-R\-T\-\_\-\-S\-Y\-S\-T\-M\-R\-\_\-\-I\-N\-I\-T}()
\begin{DoxyCompactList}\small\item\em Initialize system timer and associated interrupt. \end{DoxyCompactList}\item 
\#define \hyperlink{group__template__cpu__intf_ga9da245ecf0f472f0e749fb360d1dd056}{P\-O\-R\-T\-\_\-\-S\-Y\-S\-T\-M\-R\-\_\-\-T\-E\-R\-M}()
\begin{DoxyCompactList}\small\item\em Stop the timer if it is running and disable associated interrupt. \end{DoxyCompactList}\item 
\#define \hyperlink{group__template__cpu__intf_ga148b9eebb96ac28f7e84b94602d3b971}{P\-O\-R\-T\-\_\-\-S\-Y\-S\-T\-M\-R\-\_\-\-G\-E\-T\-\_\-\-R\-V\-A\-L}()
\begin{DoxyCompactList}\small\item\em Get system timer reload value. \end{DoxyCompactList}\item 
\#define \hyperlink{group__template__cpu__intf_gacf78b07f0013cd7a1d06b258e37016e3}{P\-O\-R\-T\-\_\-\-S\-Y\-S\-T\-M\-R\-\_\-\-G\-E\-T\-\_\-\-C\-V\-A\-L}()
\begin{DoxyCompactList}\small\item\em Get system timer current value. \end{DoxyCompactList}\item 
\#define \hyperlink{group__template__cpu__intf_ga978c719faf8d3026aa9714561e8cd522}{P\-O\-R\-T\-\_\-\-S\-Y\-S\-T\-M\-R\-\_\-\-R\-L\-D}(val)
\begin{DoxyCompactList}\small\item\em Reload the system timer with specified number. \end{DoxyCompactList}\item 
\#define \hyperlink{group__template__cpu__intf_ga566d86ffb8459153b9bc95a7d9dfb8ca}{P\-O\-R\-T\-\_\-\-S\-Y\-S\-T\-M\-R\-\_\-\-E\-N\-A\-B\-L\-E}()
\begin{DoxyCompactList}\small\item\em Enable the system timer. \end{DoxyCompactList}\item 
\#define \hyperlink{group__template__cpu__intf_ga2a361d660165aff766184242c274fe40}{P\-O\-R\-T\-\_\-\-S\-Y\-S\-T\-M\-R\-\_\-\-D\-I\-S\-A\-B\-L\-E}()
\begin{DoxyCompactList}\small\item\em Disable the system timer. \end{DoxyCompactList}\item 
\#define \hyperlink{group__template__cpu__intf_ga3863363d274eeebcf2ad0a3887068e87}{P\-O\-R\-T\-\_\-\-S\-Y\-S\-T\-M\-R\-\_\-\-I\-S\-R\-\_\-\-E\-N\-A\-B\-L\-E}()
\begin{DoxyCompactList}\small\item\em Enable the system timer interrupt. \end{DoxyCompactList}\item 
\#define \hyperlink{group__template__cpu__intf_gac2054b84d008e800a13b0e25f93e2dd9}{P\-O\-R\-T\-\_\-\-S\-Y\-S\-T\-M\-R\-\_\-\-I\-S\-R\-\_\-\-D\-I\-S\-A\-B\-L\-E}()
\begin{DoxyCompactList}\small\item\em Disable the system timer interrupt. \end{DoxyCompactList}\item 
uint\-\_\-fast8\-\_\-t \hyperlink{group__template__cpu__intf_ga548cbf806bfd34904f60a1f8db0ce965}{port\-Find\-Last\-Set\-\_\-} (\hyperlink{group__template__cpu__intf_ga99980ab56ce9857e7380210d12e3d41f}{port\-Reg\-\_\-\-T} val)
\begin{DoxyCompactList}\small\item\em Find last set bit in a word. \end{DoxyCompactList}\end{DoxyCompactItemize}
\subsubsection*{Dispatcher context switching}
\begin{DoxyCompactItemize}
\item 
\#define \hyperlink{group__template__cpu__intf_ga80d15a56d61c9d4e786e52006ff4ac43}{P\-O\-R\-T\-\_\-\-C\-T\-X\-\_\-\-I\-N\-I\-T}(stck, stack\-Size, thread, arg)
\begin{DoxyCompactList}\small\item\em Initialize the thread context. \end{DoxyCompactList}\item 
\#define \hyperlink{group__template__cpu__intf_ga50a3b72a7f2065922811f0d6dedda01a}{P\-O\-R\-T\-\_\-\-C\-T\-X\-\_\-\-S\-W}()
\begin{DoxyCompactList}\small\item\em Do the context switch -\/ invoked from A\-P\-I level. \end{DoxyCompactList}\item 
\#define \hyperlink{group__template__cpu__intf_ga20bba8f9c5a2f38fd7c63b9d2320e511}{P\-O\-R\-T\-\_\-\-C\-T\-X\-\_\-\-S\-W\-\_\-\-I\-S\-R}()
\begin{DoxyCompactList}\small\item\em Do the context switch -\/ invoked from I\-S\-R level. \end{DoxyCompactList}\item 
\#define \hyperlink{group__template__cpu__intf_ga07b918aaaed3cd0dbe89eb780ce3cb36}{P\-O\-R\-T\-\_\-\-T\-H\-D\-\_\-\-S\-T\-A\-R\-T}()
\begin{DoxyCompactList}\small\item\em Start the first thread. \end{DoxyCompactList}\item 
void $\ast$ \hyperlink{group__template__cpu__intf_ga91a1dc500f743c80ec573148a99add67}{port\-Ctx\-Init\-\_\-} (void $\ast$stck, size\-\_\-t stck\-Size, void($\ast$fn)(void $\ast$), void $\ast$arg)
\begin{DoxyCompactList}\small\item\em Initialize the thread context. \end{DoxyCompactList}\end{DoxyCompactItemize}


\subsubsection{Detailed Description}
Interface of C\-P\-U port -\/ Template. \begin{DoxyAuthor}{Author}
Nenad Radulovic 
\end{DoxyAuthor}
