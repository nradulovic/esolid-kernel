\hypertarget{cpu_8h}{\subsection{cpu.\-h File Reference}
\label{cpu_8h}\index{cpu.\-h@{cpu.\-h}}
}


Interface of C\-P\-U port -\/ Template.  


{\ttfamily \#include \char`\"{}arch/compiler.\-h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}arch/cpu\-\_\-cfg.\-h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}kernel\-\_\-cfg.\-h\char`\"{}}\\*
Include dependency graph for cpu.\-h\-:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{cpu_8h__incl}
\end{center}
\end{figure}
This graph shows which files directly or indirectly include this file\-:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=304pt]{cpu_8h__dep__incl}
\end{center}
\end{figure}
\subsubsection*{Data Structures}
\begin{DoxyCompactItemize}
\item 
struct \hyperlink{structportStck}{port\-Stck}
\begin{DoxyCompactList}\small\item\em Stack structure used for stack declaration in order to force the alignment Alignment of stack structure. \end{DoxyCompactList}\item 
struct \hyperlink{structportCtx}{port\-Ctx}
\begin{DoxyCompactList}\small\item\em Port context structure. \end{DoxyCompactList}\end{DoxyCompactItemize}
\subsubsection*{Macros}
\begin{Indent}{\bf Port constants}\par
\begin{DoxyCompactItemize}
\item 
\#define \hyperlink{group__template__cpu__intf_ga94f9e2f68916ed411c14b60ebf2fe79a}{P\-O\-R\-T\-\_\-\-D\-E\-F\-\_\-\-D\-A\-T\-A\-\_\-\-W\-I\-D\-T\-H}~8u
\begin{DoxyCompactList}\small\item\em This macro specifies the bit width of atomic data type port\-Reg\-\_\-\-T. \end{DoxyCompactList}\item 
\#define \hyperlink{group__template__cpu__intf_gace74a9ab1eb5ab018bd8a8850696cdb7}{P\-O\-R\-T\-\_\-\-D\-E\-F\-\_\-\-D\-A\-T\-A\-\_\-\-A\-L\-I\-G\-N\-M\-E\-N\-T}~1u
\begin{DoxyCompactList}\small\item\em Defines required data alignment in bytes. \end{DoxyCompactList}\item 
\#define \hyperlink{group__template__cpu__intf_ga54bd14c990686d81c1e06bcd1791a8d7}{P\-O\-R\-T\-\_\-\-D\-E\-F\-\_\-\-M\-A\-X\-\_\-\-I\-S\-R\-\_\-\-P\-R\-I\-O}~(\hyperlink{group__template__cpu__cfg_ga8abe1fb72026056f261164fafd3ba9f6}{P\-O\-R\-T\-\_\-\-C\-F\-G\-\_\-\-M\-A\-X\-\_\-\-I\-S\-R\-\_\-\-P\-R\-I\-O})
\begin{DoxyCompactList}\small\item\em Defines maximum interrupt priority which can use kernel services. \end{DoxyCompactList}\item 
\#define \hyperlink{group__template__cpu__intf_ga5a629fee11006b5b0b97f7cb7176efd4}{P\-O\-R\-T\-\_\-\-D\-E\-F\-\_\-\-S\-T\-C\-K\-\_\-\-M\-I\-N\-S\-I\-Z\-E}~(sizeof(struct \hyperlink{structportCtx}{port\-Ctx}) / sizeof(\hyperlink{group__template__cpu__intf_ga99980ab56ce9857e7380210d12e3d41f}{port\-Reg\-\_\-\-T}))
\begin{DoxyCompactList}\small\item\em This macro specifies the minimal size of the thread stack. \end{DoxyCompactList}\end{DoxyCompactItemize}
\end{Indent}
\begin{Indent}{\bf System timer constants}\par
\begin{DoxyCompactItemize}
\item 
\#define \hyperlink{group__template__cpu__intf_ga9b9c4658370f93af1dc12ff6fda1f747}{P\-O\-R\-T\-\_\-\-D\-E\-F\-\_\-\-S\-Y\-S\-T\-M\-R\-\_\-\-O\-N\-E\-\_\-\-T\-I\-C\-K}~(C\-F\-G\-\_\-\-S\-Y\-S\-T\-M\-R\-\_\-\-C\-L\-O\-C\-K\-\_\-\-F\-R\-E\-Q\-U\-E\-N\-C\-Y / \hyperlink{group__template__kern__cfg_ga4e46164ae5a37bfc54c67b6f01d93eb1}{C\-F\-G\-\_\-\-S\-Y\-S\-T\-M\-R\-\_\-\-E\-V\-E\-N\-T\-\_\-\-F\-R\-E\-Q\-U\-E\-N\-C\-Y})
\begin{DoxyCompactList}\small\item\em System timer reload value for one tick. \end{DoxyCompactList}\item 
\#define \hyperlink{group__template__cpu__intf_ga6a4b8b0c2d2a3348d14c7c6190e99e31}{P\-O\-R\-T\-\_\-\-D\-E\-F\-\_\-\-S\-Y\-S\-T\-M\-R\-\_\-\-M\-A\-X\-\_\-\-T\-I\-C\-K\-S}~(\hyperlink{group__template__family__cfg_gaed6437f330e7be6f8d5a04a19cbe8776}{C\-P\-U\-\_\-\-D\-E\-F\-\_\-\-S\-Y\-S\-T\-M\-R\-\_\-\-M\-A\-X\-\_\-\-V\-A\-L} / \hyperlink{group__template__cpu__intf_ga9b9c4658370f93af1dc12ff6fda1f747}{P\-O\-R\-T\-\_\-\-D\-E\-F\-\_\-\-S\-Y\-S\-T\-M\-R\-\_\-\-O\-N\-E\-\_\-\-T\-I\-C\-K})
\begin{DoxyCompactList}\small\item\em Maximum number of ticks without overflowing the system timer. \end{DoxyCompactList}\item 
\#define \hyperlink{group__template__cpu__intf_ga96e15dd16b285b0feb6e225b0834ad10}{P\-O\-R\-T\-\_\-\-D\-E\-F\-\_\-\-S\-Y\-S\-T\-M\-R\-\_\-\-W\-A\-K\-E\-U\-P\-\_\-\-T\-H\-\_\-\-V\-A\-L}~600u
\begin{DoxyCompactList}\small\item\em Threshold system timer value for new tick. \end{DoxyCompactList}\end{DoxyCompactItemize}
\end{Indent}
\begin{Indent}{\bf Kernel threads port dependent settings}\par
{\em Kernel uses several threads for system management. This section defines port dependent settings for the threads. }\begin{DoxyCompactItemize}
\item 
\#define \hyperlink{group__template__cpu__intf_gabaa296d76c28043a60531ad8ed81504b}{P\-O\-R\-T\-\_\-\-D\-E\-F\-\_\-\-K\-V\-T\-M\-R\-\_\-\-S\-T\-C\-K\-\_\-\-S\-I\-Z\-E}~40u
\begin{DoxyCompactList}\small\item\em Kernel Virtual Timer Thread stack size. \end{DoxyCompactList}\item 
\#define \hyperlink{group__template__cpu__intf_ga31d47ffb78c3755575e66821b3a72a62}{P\-O\-R\-T\-\_\-\-D\-E\-F\-\_\-\-K\-I\-D\-L\-E\-\_\-\-S\-T\-C\-K\-\_\-\-S\-I\-Z\-E}~40u
\begin{DoxyCompactList}\small\item\em Kernel Idle Thread stack size. \end{DoxyCompactList}\end{DoxyCompactItemize}
\end{Indent}
\begin{Indent}{\bf Interrupt management}\par
{\em P\-O\-R\-T\-\_\-\-I\-S\-R\-\_\-... macros are used by es\-Kern\-Isr\-Enter() and es\-Kern\-Isr\-Exit() functions. They are used to keep the current level of I\-S\-R nesting. Scheduler should be invoked only from the last I\-S\-R that is executing. }\begin{DoxyCompactItemize}
\item 
\#define \hyperlink{group__template__cpu__intf_ga5419ad6790aa74c8bc670237f4f9792c}{P\-O\-R\-T\-\_\-\-I\-N\-T\-\_\-\-E\-N\-A\-B\-L\-E}()
\begin{DoxyCompactList}\small\item\em Global Enable interrupt sources. \end{DoxyCompactList}\item 
\#define \hyperlink{group__template__cpu__intf_gac73a0b0b3d8a130a8d8283be5bba057d}{P\-O\-R\-T\-\_\-\-I\-N\-T\-\_\-\-D\-I\-S\-A\-B\-L\-E}()
\begin{DoxyCompactList}\small\item\em Global Disable all interrupt sources. \end{DoxyCompactList}\item 
\#define \hyperlink{group__template__cpu__intf_gaef714a3cbef7493876ce0db1ca3b7752}{P\-O\-R\-T\-\_\-\-I\-N\-T\-\_\-\-P\-R\-I\-O\-\_\-\-S\-E\-T}(prio)
\begin{DoxyCompactList}\small\item\em Set interrupt priority mask. \end{DoxyCompactList}\item 
\#define \hyperlink{group__template__cpu__intf_gaf14788ec3924ab88d0c30cf111d1f961}{P\-O\-R\-T\-\_\-\-I\-N\-T\-\_\-\-P\-R\-I\-O\-\_\-\-G\-E\-T}(prio)
\begin{DoxyCompactList}\small\item\em Get current interrupt priority mask. \end{DoxyCompactList}\item 
\#define \hyperlink{group__template__cpu__intf_ga85a60a2367e9911a383e1c6fe58b4e2c}{P\-O\-R\-T\-\_\-\-I\-N\-T\-\_\-\-P\-R\-I\-O\-\_\-\-R\-E\-P\-L\-A\-C\-E}(old\-Prio, new\-Prio)
\begin{DoxyCompactList}\small\item\em Get current and set new interrupt priority mask. \end{DoxyCompactList}\item 
\#define \hyperlink{group__template__cpu__intf_gaccad9298c874b29753b318d4f900cb75}{P\-O\-R\-T\-\_\-\-I\-S\-R\-\_\-\-E\-N\-T\-E\-R}()
\begin{DoxyCompactList}\small\item\em Enter I\-S\-R. Increment Port\-Isr\-Nesting variable to keep track of I\-S\-R nesting. \end{DoxyCompactList}\item 
\#define \hyperlink{group__template__cpu__intf_ga267c312d7321e9361b454f4274bbc087}{P\-O\-R\-T\-\_\-\-I\-S\-R\-\_\-\-E\-X\-I\-T}()
\begin{DoxyCompactList}\small\item\em Exit I\-S\-R. Decrement Port\-Isr\-Nesting variable to keep track of I\-S\-R nesting. \end{DoxyCompactList}\item 
\#define \hyperlink{group__template__cpu__intf_ga6c0ea20c8e1f6b9751f51916da8e2aee}{P\-O\-R\-T\-\_\-\-I\-S\-R\-\_\-\-I\-S\-\_\-\-L\-A\-S\-T}()~(0u == Port\-Isr\-Nesting ? T\-R\-U\-E \-: F\-A\-L\-S\-E)
\begin{DoxyCompactList}\small\item\em If isr\-Nesting variable is zero then the last I\-S\-R is executing and scheduler should be invoked. \end{DoxyCompactList}\end{DoxyCompactItemize}
\end{Indent}
\begin{Indent}{\bf System timer management}\par
\begin{DoxyCompactItemize}
\item 
\#define \hyperlink{group__template__cpu__intf_ga2174da5f10720a244c612252cad024d4}{P\-O\-R\-T\-\_\-\-S\-Y\-S\-T\-M\-R\-\_\-\-I\-N\-I\-T}(val)
\begin{DoxyCompactList}\small\item\em Initialize system timer and associated interrupt. \end{DoxyCompactList}\item 
\#define \hyperlink{group__template__cpu__intf_ga9da245ecf0f472f0e749fb360d1dd056}{P\-O\-R\-T\-\_\-\-S\-Y\-S\-T\-M\-R\-\_\-\-T\-E\-R\-M}()
\begin{DoxyCompactList}\small\item\em Stop the timer if it is running and disable associated interrupt. \end{DoxyCompactList}\item 
\#define \hyperlink{group__template__cpu__intf_ga148b9eebb96ac28f7e84b94602d3b971}{P\-O\-R\-T\-\_\-\-S\-Y\-S\-T\-M\-R\-\_\-\-G\-E\-T\-\_\-\-R\-V\-A\-L}()
\begin{DoxyCompactList}\small\item\em Get system timer reload value. \end{DoxyCompactList}\item 
\#define \hyperlink{group__template__cpu__intf_gacf78b07f0013cd7a1d06b258e37016e3}{P\-O\-R\-T\-\_\-\-S\-Y\-S\-T\-M\-R\-\_\-\-G\-E\-T\-\_\-\-C\-V\-A\-L}()
\begin{DoxyCompactList}\small\item\em Get system timer current value. \end{DoxyCompactList}\item 
\#define \hyperlink{group__template__cpu__intf_ga978c719faf8d3026aa9714561e8cd522}{P\-O\-R\-T\-\_\-\-S\-Y\-S\-T\-M\-R\-\_\-\-R\-L\-D}(val)
\begin{DoxyCompactList}\small\item\em Reload the system timer with specified number. \end{DoxyCompactList}\item 
\#define \hyperlink{group__template__cpu__intf_ga566d86ffb8459153b9bc95a7d9dfb8ca}{P\-O\-R\-T\-\_\-\-S\-Y\-S\-T\-M\-R\-\_\-\-E\-N\-A\-B\-L\-E}()
\begin{DoxyCompactList}\small\item\em Enable the system timer. \end{DoxyCompactList}\item 
\#define \hyperlink{group__template__cpu__intf_ga2a361d660165aff766184242c274fe40}{P\-O\-R\-T\-\_\-\-S\-Y\-S\-T\-M\-R\-\_\-\-D\-I\-S\-A\-B\-L\-E}()
\begin{DoxyCompactList}\small\item\em Disable the system timer. \end{DoxyCompactList}\item 
\#define \hyperlink{group__template__cpu__intf_ga3863363d274eeebcf2ad0a3887068e87}{P\-O\-R\-T\-\_\-\-S\-Y\-S\-T\-M\-R\-\_\-\-I\-S\-R\-\_\-\-E\-N\-A\-B\-L\-E}()
\begin{DoxyCompactList}\small\item\em Enable the system timer interrupt. \end{DoxyCompactList}\item 
\#define \hyperlink{group__template__cpu__intf_gac2054b84d008e800a13b0e25f93e2dd9}{P\-O\-R\-T\-\_\-\-S\-Y\-S\-T\-M\-R\-\_\-\-I\-S\-R\-\_\-\-D\-I\-S\-A\-B\-L\-E}()
\begin{DoxyCompactList}\small\item\em Disable the system timer interrupt. \end{DoxyCompactList}\end{DoxyCompactItemize}
\end{Indent}
\begin{Indent}{\bf Scheduler bit operations support}\par
\begin{DoxyCompactItemize}
\item 
\#define \hyperlink{group__template__cpu__intf_gad77a6570361843fdf0aafde890682a9a}{P\-O\-R\-T\-\_\-\-B\-I\-T\-\_\-\-F\-I\-N\-D\-\_\-\-L\-A\-S\-T\-\_\-\-S\-E\-T}(val)~\hyperlink{group__template__cpu__impl_ga9d0c9dd1722f6025086dcd437c1cd2b5}{port\-Find\-Last\-Set}(val)
\begin{DoxyCompactList}\small\item\em Find last set bit in a word. \end{DoxyCompactList}\item 
\#define \hyperlink{group__template__cpu__intf_gac2e9e677828a5a45989ba97e7f5b68ea}{P\-O\-R\-T\-\_\-\-B\-I\-T\-\_\-\-P\-W\-R2}(pwr)~(1\-U $<$$<$ (pwr))
\begin{DoxyCompactList}\small\item\em Helper macro\-: calculate 2$^\wedge$pwr expression. \end{DoxyCompactList}\end{DoxyCompactItemize}
\end{Indent}
\begin{Indent}{\bf General port macros}\par
\begin{DoxyCompactItemize}
\item 
\#define \hyperlink{group__template__cpu__intf_gac9622b857ad35f73ae92a44a9d0f717c}{P\-O\-R\-T\-\_\-\-I\-N\-I\-T\-\_\-\-E\-A\-R\-L\-Y}()
\begin{DoxyCompactList}\small\item\em Early port initialization. \end{DoxyCompactList}\item 
\#define \hyperlink{group__template__cpu__intf_ga0da077bab2264b11c4107f0bef279b86}{P\-O\-R\-T\-\_\-\-I\-N\-I\-T}()
\begin{DoxyCompactList}\small\item\em Port initialization. \end{DoxyCompactList}\item 
\#define \hyperlink{group__template__cpu__intf_ga8bfda2e0a8029092d0377640ba228b6d}{P\-O\-R\-T\-\_\-\-I\-N\-I\-T\-\_\-\-L\-A\-T\-E}()
\begin{DoxyCompactList}\small\item\em Late port initialization. \end{DoxyCompactList}\item 
\#define \hyperlink{group__template__cpu__intf_gab2a39b200d6e6806896ba45a9c3a9d1e}{P\-O\-R\-T\-\_\-\-T\-E\-R\-M}()
\begin{DoxyCompactList}\small\item\em Terminate port. \end{DoxyCompactList}\item 
\#define \hyperlink{group__template__cpu__intf_gacb3a46e89d327fbaf5c122fe23877b24}{P\-O\-R\-T\-\_\-\-S\-T\-C\-K\-\_\-\-S\-I\-Z\-E}(size)
\begin{DoxyCompactList}\small\item\em Calculate the stack size. \end{DoxyCompactList}\item 
\#define \hyperlink{group__template__cpu__intf_gad699a79233d442ae90a69c113e314542}{P\-O\-R\-T\-\_\-\-C\-R\-I\-T\-I\-C\-A\-L\-\_\-\-E\-X\-I\-T\-\_\-\-S\-L\-E\-E\-P}()~port\-Int\-Set\-Sleep\-Enter\-\_\-(int\-Status\-\_\-)
\begin{DoxyCompactList}\small\item\em Exit critical section and enter sleep state. \end{DoxyCompactList}\end{DoxyCompactItemize}
\end{Indent}
\subsubsection*{Typedefs}
\begin{DoxyCompactItemize}
\item 
typedef uint8\-\_\-t \hyperlink{group__template__cpu__intf_ga99980ab56ce9857e7380210d12e3d41f}{port\-Reg\-\_\-\-T}
\begin{DoxyCompactList}\small\item\em Data type which corresponds to the general purpose register. \end{DoxyCompactList}\item 
typedef struct \hyperlink{structportStck}{port\-Stck} \hyperlink{group__template__cpu__intf_ga13cc91970e3e05fe4210440c068d3f4a}{port\-Stck\-\_\-\-T}
\begin{DoxyCompactList}\small\item\em Stack type. \end{DoxyCompactList}\end{DoxyCompactItemize}
\subsubsection*{Functions}
\begin{Indent}{\bf Scheduler support}\par
{\em \begin{DoxyNote}{Note}
These functions are extensively used by the scheduler and therefore they should be optimized for the architecture being used. 
\end{DoxyNote}
}\begin{DoxyCompactItemize}
\item 
uint\-\_\-fast8\-\_\-t \hyperlink{group__template__cpu__intf_ga9d0c9dd1722f6025086dcd437c1cd2b5}{port\-Find\-Last\-Set} (\hyperlink{group__template__cpu__intf_ga99980ab56ce9857e7380210d12e3d41f}{port\-Reg\-\_\-\-T} val)
\begin{DoxyCompactList}\small\item\em Find last set bit in a word. \end{DoxyCompactList}\end{DoxyCompactItemize}
\end{Indent}
\subsubsection*{Variables}
\begin{DoxyCompactItemize}
\item 
\hyperlink{group__template__cpu__intf_ga99980ab56ce9857e7380210d12e3d41f}{port\-Reg\-\_\-\-T} \hyperlink{group__template__cpu__intf_gab0ad3c664e66a9a334daa4109c14e585}{Port\-Isr\-Nesting}
\begin{DoxyCompactList}\small\item\em Variable to keep track of I\-S\-R nesting. \end{DoxyCompactList}\item 
const P\-O\-R\-T\-\_\-\-C\-\_\-\-R\-O\-M \hyperlink{group__template__cpu__intf_ga99980ab56ce9857e7380210d12e3d41f}{port\-Reg\-\_\-\-T} \hyperlink{group__template__cpu__intf_ga15b2af2d2db913d66f3cfba16b8e8a57}{Pwr2\-L\-K\-P} \mbox{[}\hyperlink{group__template__cpu__intf_ga94f9e2f68916ed411c14b60ebf2fe79a}{P\-O\-R\-T\-\_\-\-D\-E\-F\-\_\-\-D\-A\-T\-A\-\_\-\-W\-I\-D\-T\-H}\mbox{]}
\begin{DoxyCompactList}\small\item\em Look up table for\-: 2$^\wedge$n expression. \end{DoxyCompactList}\end{DoxyCompactItemize}
\subsubsection*{Dispatcher context switching}
\begin{DoxyCompactItemize}
\item 
\#define \hyperlink{group__template__cpu__intf_ga80d15a56d61c9d4e786e52006ff4ac43}{P\-O\-R\-T\-\_\-\-C\-T\-X\-\_\-\-I\-N\-I\-T}(stck, stack\-Size, thread, arg)
\begin{DoxyCompactList}\small\item\em Initialize the thread context. \end{DoxyCompactList}\item 
\#define \hyperlink{group__template__cpu__intf_ga50a3b72a7f2065922811f0d6dedda01a}{P\-O\-R\-T\-\_\-\-C\-T\-X\-\_\-\-S\-W}()
\begin{DoxyCompactList}\small\item\em Do the context switch -\/ invoked from A\-P\-I level. \end{DoxyCompactList}\item 
\#define \hyperlink{group__template__cpu__intf_ga20bba8f9c5a2f38fd7c63b9d2320e511}{P\-O\-R\-T\-\_\-\-C\-T\-X\-\_\-\-S\-W\-\_\-\-I\-S\-R}()
\begin{DoxyCompactList}\small\item\em Do the context switch -\/ invoked from I\-S\-R level. \end{DoxyCompactList}\item 
\#define \hyperlink{group__template__cpu__intf_ga58056289ebeda87723f99f5431c6239e}{P\-O\-R\-T\-\_\-\-C\-T\-X\-\_\-\-S\-W\-\_\-\-S\-T\-A\-R\-T}()
\begin{DoxyCompactList}\small\item\em Start the first thread. \end{DoxyCompactList}\item 
void $\ast$ \hyperlink{group__template__cpu__intf_gaa097ec2ead487892969bcd2806539822}{port\-Ctx\-Init} (void $\ast$stck, size\-\_\-t stck\-Size, void($\ast$fn)(void $\ast$), void $\ast$arg)
\begin{DoxyCompactList}\small\item\em Initialize the thread context. \end{DoxyCompactList}\end{DoxyCompactItemize}


\subsubsection{Detailed Description}
Interface of C\-P\-U port -\/ Template. \begin{DoxyAuthor}{Author}
Nenad Radulovic 
\end{DoxyAuthor}
