\hypertarget{group__template__cpu__intf}{\subsection{C\-P\-U port interface}
\label{group__template__cpu__intf}\index{C\-P\-U port interface@{C\-P\-U port interface}}
}


C\-P\-U port macros and functions.  


Collaboration diagram for C\-P\-U port interface\-:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=290pt]{group__template__cpu__intf}
\end{center}
\end{figure}
\subsubsection*{Data Structures}
\begin{DoxyCompactItemize}
\item 
struct \hyperlink{structportStck}{port\-Stck}
\begin{DoxyCompactList}\small\item\em Stack structure used for stack declaration in order to force the alignment Alignment of stack structure. \end{DoxyCompactList}\item 
struct \hyperlink{structportCtx}{port\-Ctx}
\begin{DoxyCompactList}\small\item\em Port context structure. \end{DoxyCompactList}\end{DoxyCompactItemize}
\subsubsection*{Typedefs}
\begin{DoxyCompactItemize}
\item 
typedef struct \hyperlink{structportStck}{port\-Stck} \hyperlink{group__template__cpu__intf_ga13cc91970e3e05fe4210440c068d3f4a}{port\-Stck\-\_\-\-T}
\begin{DoxyCompactList}\small\item\em Stack type. \end{DoxyCompactList}\end{DoxyCompactItemize}
\subsubsection*{Variables}
\begin{DoxyCompactItemize}
\item 
port\-Reg\-\_\-\-T \hyperlink{group__template__cpu__intf_gab0ad3c664e66a9a334daa4109c14e585}{Port\-Isr\-Nesting}
\begin{DoxyCompactList}\small\item\em Variable to keep track of I\-S\-R nesting. \end{DoxyCompactList}\end{DoxyCompactItemize}
\subsubsection*{Port constants}
\begin{DoxyCompactItemize}
\item 
\#define \hyperlink{group__template__cpu__intf_ga5a629fee11006b5b0b97f7cb7176efd4}{P\-O\-R\-T\-\_\-\-D\-E\-F\-\_\-\-S\-T\-C\-K\-\_\-\-M\-I\-N\-S\-I\-Z\-E}~(sizeof(struct \hyperlink{structportCtx}{port\-Ctx}) / sizeof(port\-Reg\-\_\-\-T))
\begin{DoxyCompactList}\small\item\em This macro specifies the minimal size of the thread stack. \end{DoxyCompactList}\end{DoxyCompactItemize}
\subsubsection*{System timer constants}
\begin{DoxyCompactItemize}
\item 
\#define \hyperlink{group__template__cpu__intf_ga96e15dd16b285b0feb6e225b0834ad10}{P\-O\-R\-T\-\_\-\-D\-E\-F\-\_\-\-S\-Y\-S\-T\-M\-R\-\_\-\-W\-A\-K\-E\-U\-P\-\_\-\-T\-H\-\_\-\-V\-A\-L}~600u
\begin{DoxyCompactList}\small\item\em Threshold system timer value for new tick. \end{DoxyCompactList}\end{DoxyCompactItemize}
\subsubsection*{Kernel threads port dependent settings}
\label{_amgrp0e6f87e4f5cc0437b98e154b3e410859}%
Kernel uses several threads for system management. This section defines port dependent settings for the threads. \begin{DoxyCompactItemize}
\item 
\#define \hyperlink{group__template__cpu__intf_gabaa296d76c28043a60531ad8ed81504b}{P\-O\-R\-T\-\_\-\-D\-E\-F\-\_\-\-K\-V\-T\-M\-R\-\_\-\-S\-T\-C\-K\-\_\-\-S\-I\-Z\-E}~40u
\begin{DoxyCompactList}\small\item\em Kernel Virtual Timer Thread stack size. \end{DoxyCompactList}\item 
\#define \hyperlink{group__template__cpu__intf_ga31d47ffb78c3755575e66821b3a72a62}{P\-O\-R\-T\-\_\-\-D\-E\-F\-\_\-\-K\-I\-D\-L\-E\-\_\-\-S\-T\-C\-K\-\_\-\-S\-I\-Z\-E}~40u
\begin{DoxyCompactList}\small\item\em Kernel Idle Thread stack size. \end{DoxyCompactList}\end{DoxyCompactItemize}
\subsubsection*{Interrupt management}
\label{_amgrp0762f598cbb5b37886374004ead985d4}%
P\-O\-R\-T\-\_\-\-I\-S\-R\-\_\-... macros are used by es\-Kern\-Isr\-Enter() and es\-Kern\-Isr\-Exit() functions. They are used to keep the current level of I\-S\-R nesting. Scheduler should be invoked only from the last I\-S\-R that is executing. \begin{DoxyCompactItemize}
\item 
\#define \hyperlink{group__template__cpu__intf_gaccad9298c874b29753b318d4f900cb75}{P\-O\-R\-T\-\_\-\-I\-S\-R\-\_\-\-E\-N\-T\-E\-R}()
\begin{DoxyCompactList}\small\item\em Enter I\-S\-R. Increment Port\-Isr\-Nesting variable to keep track of I\-S\-R nesting. \end{DoxyCompactList}\item 
\#define \hyperlink{group__template__cpu__intf_ga267c312d7321e9361b454f4274bbc087}{P\-O\-R\-T\-\_\-\-I\-S\-R\-\_\-\-E\-X\-I\-T}()
\begin{DoxyCompactList}\small\item\em Exit I\-S\-R. Decrement Port\-Isr\-Nesting variable to keep track of I\-S\-R nesting. \end{DoxyCompactList}\item 
\#define \hyperlink{group__template__cpu__intf_ga6c0ea20c8e1f6b9751f51916da8e2aee}{P\-O\-R\-T\-\_\-\-I\-S\-R\-\_\-\-I\-S\-\_\-\-L\-A\-S\-T}()~(0u == Port\-Isr\-Nesting ? T\-R\-U\-E \-: F\-A\-L\-S\-E)
\begin{DoxyCompactList}\small\item\em If isr\-Nesting variable is zero then the last I\-S\-R is executing and scheduler should be invoked. \end{DoxyCompactList}\end{DoxyCompactItemize}
\subsubsection*{Dispatcher context switching}
\begin{DoxyCompactItemize}
\item 
void $\ast$ \hyperlink{group__template__cpu__intf_gaa097ec2ead487892969bcd2806539822}{port\-Ctx\-Init} (void $\ast$stck, size\-\_\-t stck\-Size, void($\ast$fn)(void $\ast$), void $\ast$arg)
\begin{DoxyCompactList}\small\item\em Initialize the thread context. \end{DoxyCompactList}\item 
\#define \hyperlink{group__template__cpu__intf_ga80d15a56d61c9d4e786e52006ff4ac43}{P\-O\-R\-T\-\_\-\-C\-T\-X\-\_\-\-I\-N\-I\-T}(stck, stack\-Size, thread, arg)
\begin{DoxyCompactList}\small\item\em Initialize the thread context. \end{DoxyCompactList}\item 
\#define \hyperlink{group__template__cpu__intf_ga50a3b72a7f2065922811f0d6dedda01a}{P\-O\-R\-T\-\_\-\-C\-T\-X\-\_\-\-S\-W}()
\begin{DoxyCompactList}\small\item\em Do the context switch -\/ invoked from A\-P\-I level. \end{DoxyCompactList}\item 
\#define \hyperlink{group__template__cpu__intf_ga20bba8f9c5a2f38fd7c63b9d2320e511}{P\-O\-R\-T\-\_\-\-C\-T\-X\-\_\-\-S\-W\-\_\-\-I\-S\-R}()
\begin{DoxyCompactList}\small\item\em Do the context switch -\/ invoked from I\-S\-R level. \end{DoxyCompactList}\item 
\#define \hyperlink{group__template__cpu__intf_ga58056289ebeda87723f99f5431c6239e}{P\-O\-R\-T\-\_\-\-C\-T\-X\-\_\-\-S\-W\-\_\-\-S\-T\-A\-R\-T}()
\begin{DoxyCompactList}\small\item\em Start the first thread. \end{DoxyCompactList}\end{DoxyCompactItemize}
\subsubsection*{General port macros}
\begin{DoxyCompactItemize}
\item 
\#define \hyperlink{group__template__cpu__intf_gabf0ea7d36355a7133ee9e9f8abafa6ff}{P\-O\-R\-T\-\_\-\-K\-C\-O\-R\-E\-\_\-\-I\-N\-I\-T\-\_\-\-E\-A\-R\-L\-Y}()
\begin{DoxyCompactList}\small\item\em Early port initialization. \end{DoxyCompactList}\item 
\#define \hyperlink{group__template__cpu__intf_ga682a913f5439544d4f0ee14ae68507fd}{P\-O\-R\-T\-\_\-\-K\-C\-O\-R\-E\-\_\-\-I\-N\-I\-T}()
\begin{DoxyCompactList}\small\item\em Port initialization. \end{DoxyCompactList}\item 
\#define \hyperlink{group__template__cpu__intf_ga5c133105168261f1744abf3c5917a515}{P\-O\-R\-T\-\_\-\-K\-C\-O\-R\-E\-\_\-\-I\-N\-I\-T\-\_\-\-L\-A\-T\-E}()
\begin{DoxyCompactList}\small\item\em Late port initialization. \end{DoxyCompactList}\item 
\#define \hyperlink{group__template__cpu__intf_gac386e206a8b5225c9aa56be88b625837}{P\-O\-R\-T\-\_\-\-K\-C\-O\-R\-E\-\_\-\-T\-E\-R\-M}()
\begin{DoxyCompactList}\small\item\em Terminate port. \end{DoxyCompactList}\item 
\#define \hyperlink{group__template__cpu__intf_gacb3a46e89d327fbaf5c122fe23877b24}{P\-O\-R\-T\-\_\-\-S\-T\-C\-K\-\_\-\-S\-I\-Z\-E}(size)~(size + \hyperlink{group__template__cpu__intf_ga5a629fee11006b5b0b97f7cb7176efd4}{P\-O\-R\-T\-\_\-\-D\-E\-F\-\_\-\-S\-T\-C\-K\-\_\-\-M\-I\-N\-S\-I\-Z\-E})
\begin{DoxyCompactList}\small\item\em Calculate the stack size. \end{DoxyCompactList}\item 
\#define \hyperlink{group__template__cpu__intf_gad699a79233d442ae90a69c113e314542}{P\-O\-R\-T\-\_\-\-C\-R\-I\-T\-I\-C\-A\-L\-\_\-\-E\-X\-I\-T\-\_\-\-S\-L\-E\-E\-P}()~port\-Int\-Set\-Sleep\-Enter\-\_\-(int\-Status\-\_\-)
\begin{DoxyCompactList}\small\item\em Exit critical section and enter sleep state. \end{DoxyCompactList}\end{DoxyCompactItemize}


\subsubsection{Detailed Description}
C\-P\-U port macros and functions. Since this header file is included with the A\-P\-I of the kernel a few naming conventions are defined in order to avoid name clashing with the names of objects from libraries included by application code.

\begin{DoxyParagraph}{1) Macro naming conventions}
For macro naming try to follow these rules\-:
\begin{DoxyItemize}
\item All standard P\-O\-R\-T A\-P\-I macro names are prefixed with\-: {\bfseries {\ttfamily P\-O\-R\-T\-\_\-}.} 
\item All other macros which are specific to the port used are prefixed with\-: {\bfseries {\ttfamily C\-P\-U\-\_\-}.} 
\end{DoxyItemize}
\end{DoxyParagraph}
\begin{DoxyParagraph}{2) Type declaration naming conventions}
For type declaration naming try to follow these rules\-:
\begin{DoxyItemize}
\item All type declaration names are prefixed with\-: {\bfseries {\ttfamily port}.} 
\end{DoxyItemize}
\end{DoxyParagraph}
\begin{DoxyParagraph}{3) Global variable naming conventions}
For global variable naming try to follow these rules\-:
\begin{DoxyItemize}
\item All global variable names are prefixed with\-: {\bfseries {\ttfamily Port}.} 
\end{DoxyItemize}
\end{DoxyParagraph}
\begin{DoxyParagraph}{4) Function naming conventions}
For functions naming try to follow these rules\-:
\begin{DoxyItemize}
\item All standard P\-O\-R\-T A\-P\-I function names are prefixed with\-: {\bfseries {\ttfamily port}}.
\item All other functions which are specific to the port used are prefixed with\-: {\bfseries {\ttfamily cpu}}
\item All inline functions are additionally postfixed with\-: {\bfseries {\ttfamily \-\_\-} }(underscore).
\item The {\ttfamily exception} to above two rules are the names of functions used for Interrupt Service Routines. They can have any name required by the port. 
\end{DoxyItemize}
\end{DoxyParagraph}


\subsubsection{Macro Definition Documentation}
\hypertarget{group__template__cpu__intf_ga5a629fee11006b5b0b97f7cb7176efd4}{\index{C\-P\-U port interface@{C\-P\-U port interface}!P\-O\-R\-T\-\_\-\-D\-E\-F\-\_\-\-S\-T\-C\-K\-\_\-\-M\-I\-N\-S\-I\-Z\-E@{P\-O\-R\-T\-\_\-\-D\-E\-F\-\_\-\-S\-T\-C\-K\-\_\-\-M\-I\-N\-S\-I\-Z\-E}}
\index{P\-O\-R\-T\-\_\-\-D\-E\-F\-\_\-\-S\-T\-C\-K\-\_\-\-M\-I\-N\-S\-I\-Z\-E@{P\-O\-R\-T\-\_\-\-D\-E\-F\-\_\-\-S\-T\-C\-K\-\_\-\-M\-I\-N\-S\-I\-Z\-E}!CPU port interface@{C\-P\-U port interface}}
\paragraph[{P\-O\-R\-T\-\_\-\-D\-E\-F\-\_\-\-S\-T\-C\-K\-\_\-\-M\-I\-N\-S\-I\-Z\-E}]{\setlength{\rightskip}{0pt plus 5cm}\#define P\-O\-R\-T\-\_\-\-D\-E\-F\-\_\-\-S\-T\-C\-K\-\_\-\-M\-I\-N\-S\-I\-Z\-E~(sizeof(struct {\bf port\-Ctx}) / sizeof(port\-Reg\-\_\-\-T))}}\label{group__template__cpu__intf_ga5a629fee11006b5b0b97f7cb7176efd4}


This macro specifies the minimal size of the thread stack. 

Generally minimal stack size is equal to the size of context structure \hypertarget{group__template__cpu__intf_ga96e15dd16b285b0feb6e225b0834ad10}{\index{C\-P\-U port interface@{C\-P\-U port interface}!P\-O\-R\-T\-\_\-\-D\-E\-F\-\_\-\-S\-Y\-S\-T\-M\-R\-\_\-\-W\-A\-K\-E\-U\-P\-\_\-\-T\-H\-\_\-\-V\-A\-L@{P\-O\-R\-T\-\_\-\-D\-E\-F\-\_\-\-S\-Y\-S\-T\-M\-R\-\_\-\-W\-A\-K\-E\-U\-P\-\_\-\-T\-H\-\_\-\-V\-A\-L}}
\index{P\-O\-R\-T\-\_\-\-D\-E\-F\-\_\-\-S\-Y\-S\-T\-M\-R\-\_\-\-W\-A\-K\-E\-U\-P\-\_\-\-T\-H\-\_\-\-V\-A\-L@{P\-O\-R\-T\-\_\-\-D\-E\-F\-\_\-\-S\-Y\-S\-T\-M\-R\-\_\-\-W\-A\-K\-E\-U\-P\-\_\-\-T\-H\-\_\-\-V\-A\-L}!CPU port interface@{C\-P\-U port interface}}
\paragraph[{P\-O\-R\-T\-\_\-\-D\-E\-F\-\_\-\-S\-Y\-S\-T\-M\-R\-\_\-\-W\-A\-K\-E\-U\-P\-\_\-\-T\-H\-\_\-\-V\-A\-L}]{\setlength{\rightskip}{0pt plus 5cm}\#define P\-O\-R\-T\-\_\-\-D\-E\-F\-\_\-\-S\-Y\-S\-T\-M\-R\-\_\-\-W\-A\-K\-E\-U\-P\-\_\-\-T\-H\-\_\-\-V\-A\-L~600u}}\label{group__template__cpu__intf_ga96e15dd16b285b0feb6e225b0834ad10}


Threshold system timer value for new tick. 

\hypertarget{group__template__cpu__intf_gabaa296d76c28043a60531ad8ed81504b}{\index{C\-P\-U port interface@{C\-P\-U port interface}!P\-O\-R\-T\-\_\-\-D\-E\-F\-\_\-\-K\-V\-T\-M\-R\-\_\-\-S\-T\-C\-K\-\_\-\-S\-I\-Z\-E@{P\-O\-R\-T\-\_\-\-D\-E\-F\-\_\-\-K\-V\-T\-M\-R\-\_\-\-S\-T\-C\-K\-\_\-\-S\-I\-Z\-E}}
\index{P\-O\-R\-T\-\_\-\-D\-E\-F\-\_\-\-K\-V\-T\-M\-R\-\_\-\-S\-T\-C\-K\-\_\-\-S\-I\-Z\-E@{P\-O\-R\-T\-\_\-\-D\-E\-F\-\_\-\-K\-V\-T\-M\-R\-\_\-\-S\-T\-C\-K\-\_\-\-S\-I\-Z\-E}!CPU port interface@{C\-P\-U port interface}}
\paragraph[{P\-O\-R\-T\-\_\-\-D\-E\-F\-\_\-\-K\-V\-T\-M\-R\-\_\-\-S\-T\-C\-K\-\_\-\-S\-I\-Z\-E}]{\setlength{\rightskip}{0pt plus 5cm}\#define P\-O\-R\-T\-\_\-\-D\-E\-F\-\_\-\-K\-V\-T\-M\-R\-\_\-\-S\-T\-C\-K\-\_\-\-S\-I\-Z\-E~40u}}\label{group__template__cpu__intf_gabaa296d76c28043a60531ad8ed81504b}


Kernel Virtual Timer Thread stack size. 

\begin{DoxyRefDesc}{Todo}
\item[\hyperlink{todo__todo000001}{Todo}]This value needs tweaking \end{DoxyRefDesc}
\hypertarget{group__template__cpu__intf_ga31d47ffb78c3755575e66821b3a72a62}{\index{C\-P\-U port interface@{C\-P\-U port interface}!P\-O\-R\-T\-\_\-\-D\-E\-F\-\_\-\-K\-I\-D\-L\-E\-\_\-\-S\-T\-C\-K\-\_\-\-S\-I\-Z\-E@{P\-O\-R\-T\-\_\-\-D\-E\-F\-\_\-\-K\-I\-D\-L\-E\-\_\-\-S\-T\-C\-K\-\_\-\-S\-I\-Z\-E}}
\index{P\-O\-R\-T\-\_\-\-D\-E\-F\-\_\-\-K\-I\-D\-L\-E\-\_\-\-S\-T\-C\-K\-\_\-\-S\-I\-Z\-E@{P\-O\-R\-T\-\_\-\-D\-E\-F\-\_\-\-K\-I\-D\-L\-E\-\_\-\-S\-T\-C\-K\-\_\-\-S\-I\-Z\-E}!CPU port interface@{C\-P\-U port interface}}
\paragraph[{P\-O\-R\-T\-\_\-\-D\-E\-F\-\_\-\-K\-I\-D\-L\-E\-\_\-\-S\-T\-C\-K\-\_\-\-S\-I\-Z\-E}]{\setlength{\rightskip}{0pt plus 5cm}\#define P\-O\-R\-T\-\_\-\-D\-E\-F\-\_\-\-K\-I\-D\-L\-E\-\_\-\-S\-T\-C\-K\-\_\-\-S\-I\-Z\-E~40u}}\label{group__template__cpu__intf_ga31d47ffb78c3755575e66821b3a72a62}


Kernel Idle Thread stack size. 

\begin{DoxyRefDesc}{Todo}
\item[\hyperlink{todo__todo000002}{Todo}]This value needs tweaking \end{DoxyRefDesc}
\hypertarget{group__template__cpu__intf_gaccad9298c874b29753b318d4f900cb75}{\index{C\-P\-U port interface@{C\-P\-U port interface}!P\-O\-R\-T\-\_\-\-I\-S\-R\-\_\-\-E\-N\-T\-E\-R@{P\-O\-R\-T\-\_\-\-I\-S\-R\-\_\-\-E\-N\-T\-E\-R}}
\index{P\-O\-R\-T\-\_\-\-I\-S\-R\-\_\-\-E\-N\-T\-E\-R@{P\-O\-R\-T\-\_\-\-I\-S\-R\-\_\-\-E\-N\-T\-E\-R}!CPU port interface@{C\-P\-U port interface}}
\paragraph[{P\-O\-R\-T\-\_\-\-I\-S\-R\-\_\-\-E\-N\-T\-E\-R}]{\setlength{\rightskip}{0pt plus 5cm}\#define P\-O\-R\-T\-\_\-\-I\-S\-R\-\_\-\-E\-N\-T\-E\-R(
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{group__template__cpu__intf_gaccad9298c874b29753b318d4f900cb75}
{\bfseries Value\-:}
\begin{DoxyCode}
\textcolor{keywordflow}{do} \{                                                                        \hyperlink{group__template__cpu__intf_gab0ad3c664e66a9a334daa4109c14e585}{\(\backslash\)}
\hyperlink{group__template__cpu__intf_gab0ad3c664e66a9a334daa4109c14e585}{        PortIsrNesting}++;                                                       
      \hyperlink{group__kern__general_gac0d578bcd4a10b2c8e5fc90f0b86ccec}{\(\backslash\)}
\hyperlink{group__kern__general_gac0d578bcd4a10b2c8e5fc90f0b86ccec}{        esKernIsrEnterI}();                                                      \(\backslash\)
    \} \textcolor{keywordflow}{while} (0u)
\end{DoxyCode}


Enter I\-S\-R. Increment Port\-Isr\-Nesting variable to keep track of I\-S\-R nesting. 

Variable Port\-Isr\-Nesting is needed only if the port does not support any other method of detecting when the last I\-S\-R is executing. \hypertarget{group__template__cpu__intf_ga267c312d7321e9361b454f4274bbc087}{\index{C\-P\-U port interface@{C\-P\-U port interface}!P\-O\-R\-T\-\_\-\-I\-S\-R\-\_\-\-E\-X\-I\-T@{P\-O\-R\-T\-\_\-\-I\-S\-R\-\_\-\-E\-X\-I\-T}}
\index{P\-O\-R\-T\-\_\-\-I\-S\-R\-\_\-\-E\-X\-I\-T@{P\-O\-R\-T\-\_\-\-I\-S\-R\-\_\-\-E\-X\-I\-T}!CPU port interface@{C\-P\-U port interface}}
\paragraph[{P\-O\-R\-T\-\_\-\-I\-S\-R\-\_\-\-E\-X\-I\-T}]{\setlength{\rightskip}{0pt plus 5cm}\#define P\-O\-R\-T\-\_\-\-I\-S\-R\-\_\-\-E\-X\-I\-T(
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{group__template__cpu__intf_ga267c312d7321e9361b454f4274bbc087}
{\bfseries Value\-:}
\begin{DoxyCode}
\textcolor{keywordflow}{do} \{                                                                        \hyperlink{group__template__cpu__intf_gab0ad3c664e66a9a334daa4109c14e585}{\(\backslash\)}
\hyperlink{group__template__cpu__intf_gab0ad3c664e66a9a334daa4109c14e585}{        PortIsrNesting}--;                                                       
      \hyperlink{group__kern__general_gaa6347925fff1684b5425dd2857c27129}{\(\backslash\)}
\hyperlink{group__kern__general_gaa6347925fff1684b5425dd2857c27129}{        esKernIsrExitI}();                                                       \(\backslash\)
    \} \textcolor{keywordflow}{while} (0u)
\end{DoxyCode}


Exit I\-S\-R. Decrement Port\-Isr\-Nesting variable to keep track of I\-S\-R nesting. 

Variable Port\-Isr\-Nesting is needed only if the port does not support any other method of detecting when the last I\-S\-R is executing. \hypertarget{group__template__cpu__intf_ga6c0ea20c8e1f6b9751f51916da8e2aee}{\index{C\-P\-U port interface@{C\-P\-U port interface}!P\-O\-R\-T\-\_\-\-I\-S\-R\-\_\-\-I\-S\-\_\-\-L\-A\-S\-T@{P\-O\-R\-T\-\_\-\-I\-S\-R\-\_\-\-I\-S\-\_\-\-L\-A\-S\-T}}
\index{P\-O\-R\-T\-\_\-\-I\-S\-R\-\_\-\-I\-S\-\_\-\-L\-A\-S\-T@{P\-O\-R\-T\-\_\-\-I\-S\-R\-\_\-\-I\-S\-\_\-\-L\-A\-S\-T}!CPU port interface@{C\-P\-U port interface}}
\paragraph[{P\-O\-R\-T\-\_\-\-I\-S\-R\-\_\-\-I\-S\-\_\-\-L\-A\-S\-T}]{\setlength{\rightskip}{0pt plus 5cm}\#define P\-O\-R\-T\-\_\-\-I\-S\-R\-\_\-\-I\-S\-\_\-\-L\-A\-S\-T(
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)~(0u == Port\-Isr\-Nesting ? T\-R\-U\-E \-: F\-A\-L\-S\-E)}}\label{group__template__cpu__intf_ga6c0ea20c8e1f6b9751f51916da8e2aee}


If isr\-Nesting variable is zero then the last I\-S\-R is executing and scheduler should be invoked. 

\begin{DoxyReturn}{Returns}
Is the currently executed I\-S\-R the last one? 
\end{DoxyReturn}

\begin{DoxyRetVals}{Return values}
{\em T\-R\-U\-E} & -\/ this is last I\-S\-R \\
\hline
{\em F\-A\-L\-S\-E} & -\/ this is not the last I\-S\-R \\
\hline
\end{DoxyRetVals}
\hypertarget{group__template__cpu__intf_ga80d15a56d61c9d4e786e52006ff4ac43}{\index{C\-P\-U port interface@{C\-P\-U port interface}!P\-O\-R\-T\-\_\-\-C\-T\-X\-\_\-\-I\-N\-I\-T@{P\-O\-R\-T\-\_\-\-C\-T\-X\-\_\-\-I\-N\-I\-T}}
\index{P\-O\-R\-T\-\_\-\-C\-T\-X\-\_\-\-I\-N\-I\-T@{P\-O\-R\-T\-\_\-\-C\-T\-X\-\_\-\-I\-N\-I\-T}!CPU port interface@{C\-P\-U port interface}}
\paragraph[{P\-O\-R\-T\-\_\-\-C\-T\-X\-\_\-\-I\-N\-I\-T}]{\setlength{\rightskip}{0pt plus 5cm}\#define P\-O\-R\-T\-\_\-\-C\-T\-X\-\_\-\-I\-N\-I\-T(
\begin{DoxyParamCaption}
\item[{}]{stck, }
\item[{}]{stack\-Size, }
\item[{}]{thread, }
\item[{}]{arg}
\end{DoxyParamCaption}
)}}\label{group__template__cpu__intf_ga80d15a56d61c9d4e786e52006ff4ac43}


Initialize the thread context. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in,out}  & {\em stck} & Pointer to the allocated thread stack. The pointer points to the beginning of the memory as defined per C language. It's up to port function to adjust the pointer according to the stack type\-: full descending or full ascending one. \\
\hline
 & {\em stack\-Size} & The size of allocated stack in bytes. \\
\hline
\mbox{\tt in}  & {\em thread} & Pointer to the thread function. \\
\hline
\mbox{\tt in}  & {\em arg} & Argument that will be passed to thread function at the starting of execution. \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
The new top of stack after thread context initialization. 
\end{DoxyReturn}
\hypertarget{group__template__cpu__intf_ga50a3b72a7f2065922811f0d6dedda01a}{\index{C\-P\-U port interface@{C\-P\-U port interface}!P\-O\-R\-T\-\_\-\-C\-T\-X\-\_\-\-S\-W@{P\-O\-R\-T\-\_\-\-C\-T\-X\-\_\-\-S\-W}}
\index{P\-O\-R\-T\-\_\-\-C\-T\-X\-\_\-\-S\-W@{P\-O\-R\-T\-\_\-\-C\-T\-X\-\_\-\-S\-W}!CPU port interface@{C\-P\-U port interface}}
\paragraph[{P\-O\-R\-T\-\_\-\-C\-T\-X\-\_\-\-S\-W}]{\setlength{\rightskip}{0pt plus 5cm}\#define P\-O\-R\-T\-\_\-\-C\-T\-X\-\_\-\-S\-W(
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{group__template__cpu__intf_ga50a3b72a7f2065922811f0d6dedda01a}


Do the context switch -\/ invoked from A\-P\-I level. 

\hypertarget{group__template__cpu__intf_ga20bba8f9c5a2f38fd7c63b9d2320e511}{\index{C\-P\-U port interface@{C\-P\-U port interface}!P\-O\-R\-T\-\_\-\-C\-T\-X\-\_\-\-S\-W\-\_\-\-I\-S\-R@{P\-O\-R\-T\-\_\-\-C\-T\-X\-\_\-\-S\-W\-\_\-\-I\-S\-R}}
\index{P\-O\-R\-T\-\_\-\-C\-T\-X\-\_\-\-S\-W\-\_\-\-I\-S\-R@{P\-O\-R\-T\-\_\-\-C\-T\-X\-\_\-\-S\-W\-\_\-\-I\-S\-R}!CPU port interface@{C\-P\-U port interface}}
\paragraph[{P\-O\-R\-T\-\_\-\-C\-T\-X\-\_\-\-S\-W\-\_\-\-I\-S\-R}]{\setlength{\rightskip}{0pt plus 5cm}\#define P\-O\-R\-T\-\_\-\-C\-T\-X\-\_\-\-S\-W\-\_\-\-I\-S\-R(
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{group__template__cpu__intf_ga20bba8f9c5a2f38fd7c63b9d2320e511}


Do the context switch -\/ invoked from I\-S\-R level. 

\hypertarget{group__template__cpu__intf_ga58056289ebeda87723f99f5431c6239e}{\index{C\-P\-U port interface@{C\-P\-U port interface}!P\-O\-R\-T\-\_\-\-C\-T\-X\-\_\-\-S\-W\-\_\-\-S\-T\-A\-R\-T@{P\-O\-R\-T\-\_\-\-C\-T\-X\-\_\-\-S\-W\-\_\-\-S\-T\-A\-R\-T}}
\index{P\-O\-R\-T\-\_\-\-C\-T\-X\-\_\-\-S\-W\-\_\-\-S\-T\-A\-R\-T@{P\-O\-R\-T\-\_\-\-C\-T\-X\-\_\-\-S\-W\-\_\-\-S\-T\-A\-R\-T}!CPU port interface@{C\-P\-U port interface}}
\paragraph[{P\-O\-R\-T\-\_\-\-C\-T\-X\-\_\-\-S\-W\-\_\-\-S\-T\-A\-R\-T}]{\setlength{\rightskip}{0pt plus 5cm}\#define P\-O\-R\-T\-\_\-\-C\-T\-X\-\_\-\-S\-W\-\_\-\-S\-T\-A\-R\-T(
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{group__template__cpu__intf_ga58056289ebeda87723f99f5431c6239e}


Start the first thread. 

\hypertarget{group__template__cpu__intf_gabf0ea7d36355a7133ee9e9f8abafa6ff}{\index{C\-P\-U port interface@{C\-P\-U port interface}!P\-O\-R\-T\-\_\-\-K\-C\-O\-R\-E\-\_\-\-I\-N\-I\-T\-\_\-\-E\-A\-R\-L\-Y@{P\-O\-R\-T\-\_\-\-K\-C\-O\-R\-E\-\_\-\-I\-N\-I\-T\-\_\-\-E\-A\-R\-L\-Y}}
\index{P\-O\-R\-T\-\_\-\-K\-C\-O\-R\-E\-\_\-\-I\-N\-I\-T\-\_\-\-E\-A\-R\-L\-Y@{P\-O\-R\-T\-\_\-\-K\-C\-O\-R\-E\-\_\-\-I\-N\-I\-T\-\_\-\-E\-A\-R\-L\-Y}!CPU port interface@{C\-P\-U port interface}}
\paragraph[{P\-O\-R\-T\-\_\-\-K\-C\-O\-R\-E\-\_\-\-I\-N\-I\-T\-\_\-\-E\-A\-R\-L\-Y}]{\setlength{\rightskip}{0pt plus 5cm}\#define P\-O\-R\-T\-\_\-\-K\-C\-O\-R\-E\-\_\-\-I\-N\-I\-T\-\_\-\-E\-A\-R\-L\-Y(
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{group__template__cpu__intf_gabf0ea7d36355a7133ee9e9f8abafa6ff}


Early port initialization. 

This macro will be called at early initialization stage from \hyperlink{group__kern__general_ga9e9ff699d62d6035cd51121bb3140704}{es\-Kern\-Init()} function. It is called before any kernel data initialization. Usually this macro would be used to setup memory space, fill the memory with debug value or something similar. \hypertarget{group__template__cpu__intf_ga682a913f5439544d4f0ee14ae68507fd}{\index{C\-P\-U port interface@{C\-P\-U port interface}!P\-O\-R\-T\-\_\-\-K\-C\-O\-R\-E\-\_\-\-I\-N\-I\-T@{P\-O\-R\-T\-\_\-\-K\-C\-O\-R\-E\-\_\-\-I\-N\-I\-T}}
\index{P\-O\-R\-T\-\_\-\-K\-C\-O\-R\-E\-\_\-\-I\-N\-I\-T@{P\-O\-R\-T\-\_\-\-K\-C\-O\-R\-E\-\_\-\-I\-N\-I\-T}!CPU port interface@{C\-P\-U port interface}}
\paragraph[{P\-O\-R\-T\-\_\-\-K\-C\-O\-R\-E\-\_\-\-I\-N\-I\-T}]{\setlength{\rightskip}{0pt plus 5cm}\#define P\-O\-R\-T\-\_\-\-K\-C\-O\-R\-E\-\_\-\-I\-N\-I\-T(
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{group__template__cpu__intf_ga682a913f5439544d4f0ee14ae68507fd}


Port initialization. 

This macro will be called after kernel data structure initialization from \hyperlink{group__kern__general_ga9e9ff699d62d6035cd51121bb3140704}{es\-Kern\-Init()} function. \hypertarget{group__template__cpu__intf_ga5c133105168261f1744abf3c5917a515}{\index{C\-P\-U port interface@{C\-P\-U port interface}!P\-O\-R\-T\-\_\-\-K\-C\-O\-R\-E\-\_\-\-I\-N\-I\-T\-\_\-\-L\-A\-T\-E@{P\-O\-R\-T\-\_\-\-K\-C\-O\-R\-E\-\_\-\-I\-N\-I\-T\-\_\-\-L\-A\-T\-E}}
\index{P\-O\-R\-T\-\_\-\-K\-C\-O\-R\-E\-\_\-\-I\-N\-I\-T\-\_\-\-L\-A\-T\-E@{P\-O\-R\-T\-\_\-\-K\-C\-O\-R\-E\-\_\-\-I\-N\-I\-T\-\_\-\-L\-A\-T\-E}!CPU port interface@{C\-P\-U port interface}}
\paragraph[{P\-O\-R\-T\-\_\-\-K\-C\-O\-R\-E\-\_\-\-I\-N\-I\-T\-\_\-\-L\-A\-T\-E}]{\setlength{\rightskip}{0pt plus 5cm}\#define P\-O\-R\-T\-\_\-\-K\-C\-O\-R\-E\-\_\-\-I\-N\-I\-T\-\_\-\-L\-A\-T\-E(
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{group__template__cpu__intf_ga5c133105168261f1744abf3c5917a515}


Late port initialization. 

This macro will be called just a moment before the multitasking is started. The macro is called from \hyperlink{group__kern__general_ga0e7a0a6b9c02df58de0f98de0229a09d}{es\-Kern\-Start()} function. \hypertarget{group__template__cpu__intf_gac386e206a8b5225c9aa56be88b625837}{\index{C\-P\-U port interface@{C\-P\-U port interface}!P\-O\-R\-T\-\_\-\-K\-C\-O\-R\-E\-\_\-\-T\-E\-R\-M@{P\-O\-R\-T\-\_\-\-K\-C\-O\-R\-E\-\_\-\-T\-E\-R\-M}}
\index{P\-O\-R\-T\-\_\-\-K\-C\-O\-R\-E\-\_\-\-T\-E\-R\-M@{P\-O\-R\-T\-\_\-\-K\-C\-O\-R\-E\-\_\-\-T\-E\-R\-M}!CPU port interface@{C\-P\-U port interface}}
\paragraph[{P\-O\-R\-T\-\_\-\-K\-C\-O\-R\-E\-\_\-\-T\-E\-R\-M}]{\setlength{\rightskip}{0pt plus 5cm}\#define P\-O\-R\-T\-\_\-\-K\-C\-O\-R\-E\-\_\-\-T\-E\-R\-M(
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{group__template__cpu__intf_gac386e206a8b5225c9aa56be88b625837}


Terminate port. 

This macro will be called when there is a need to stop any further execution (example\-: an error occurred and C\-P\-U needs to stop). \hypertarget{group__template__cpu__intf_gacb3a46e89d327fbaf5c122fe23877b24}{\index{C\-P\-U port interface@{C\-P\-U port interface}!P\-O\-R\-T\-\_\-\-S\-T\-C\-K\-\_\-\-S\-I\-Z\-E@{P\-O\-R\-T\-\_\-\-S\-T\-C\-K\-\_\-\-S\-I\-Z\-E}}
\index{P\-O\-R\-T\-\_\-\-S\-T\-C\-K\-\_\-\-S\-I\-Z\-E@{P\-O\-R\-T\-\_\-\-S\-T\-C\-K\-\_\-\-S\-I\-Z\-E}!CPU port interface@{C\-P\-U port interface}}
\paragraph[{P\-O\-R\-T\-\_\-\-S\-T\-C\-K\-\_\-\-S\-I\-Z\-E}]{\setlength{\rightskip}{0pt plus 5cm}\#define P\-O\-R\-T\-\_\-\-S\-T\-C\-K\-\_\-\-S\-I\-Z\-E(
\begin{DoxyParamCaption}
\item[{}]{size}
\end{DoxyParamCaption}
)~(size + {\bf P\-O\-R\-T\-\_\-\-D\-E\-F\-\_\-\-S\-T\-C\-K\-\_\-\-M\-I\-N\-S\-I\-Z\-E})}}\label{group__template__cpu__intf_gacb3a46e89d327fbaf5c122fe23877b24}


Calculate the stack size. 

This macro is used when specifying the size of thread stack. Responsibility\-:
\begin{DoxyItemize}
\item add to {\ttfamily size} the minimal stack size specified by {\ttfamily P\-O\-R\-T\-\_\-\-D\-E\-F\-\_\-\-D\-A\-T\-A\-\_\-\-W\-I\-D\-T\-H} macro.
\item if it is needed by the port make sure the alignment is correct. 
\end{DoxyItemize}\hypertarget{group__template__cpu__intf_gad699a79233d442ae90a69c113e314542}{\index{C\-P\-U port interface@{C\-P\-U port interface}!P\-O\-R\-T\-\_\-\-C\-R\-I\-T\-I\-C\-A\-L\-\_\-\-E\-X\-I\-T\-\_\-\-S\-L\-E\-E\-P@{P\-O\-R\-T\-\_\-\-C\-R\-I\-T\-I\-C\-A\-L\-\_\-\-E\-X\-I\-T\-\_\-\-S\-L\-E\-E\-P}}
\index{P\-O\-R\-T\-\_\-\-C\-R\-I\-T\-I\-C\-A\-L\-\_\-\-E\-X\-I\-T\-\_\-\-S\-L\-E\-E\-P@{P\-O\-R\-T\-\_\-\-C\-R\-I\-T\-I\-C\-A\-L\-\_\-\-E\-X\-I\-T\-\_\-\-S\-L\-E\-E\-P}!CPU port interface@{C\-P\-U port interface}}
\paragraph[{P\-O\-R\-T\-\_\-\-C\-R\-I\-T\-I\-C\-A\-L\-\_\-\-E\-X\-I\-T\-\_\-\-S\-L\-E\-E\-P}]{\setlength{\rightskip}{0pt plus 5cm}\#define P\-O\-R\-T\-\_\-\-C\-R\-I\-T\-I\-C\-A\-L\-\_\-\-E\-X\-I\-T\-\_\-\-S\-L\-E\-E\-P(
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)~port\-Int\-Set\-Sleep\-Enter\-\_\-(int\-Status\-\_\-)}}\label{group__template__cpu__intf_gad699a79233d442ae90a69c113e314542}


Exit critical section and enter sleep state. 



\subsubsection{Typedef Documentation}
\hypertarget{group__template__cpu__intf_ga13cc91970e3e05fe4210440c068d3f4a}{\index{C\-P\-U port interface@{C\-P\-U port interface}!port\-Stck\-\_\-\-T@{port\-Stck\-\_\-\-T}}
\index{port\-Stck\-\_\-\-T@{port\-Stck\-\_\-\-T}!CPU port interface@{C\-P\-U port interface}}
\paragraph[{port\-Stck\-\_\-\-T}]{\setlength{\rightskip}{0pt plus 5cm}typedef struct {\bf port\-Stck} {\bf port\-Stck\-\_\-\-T}}}\label{group__template__cpu__intf_ga13cc91970e3e05fe4210440c068d3f4a}


Stack type. 

Stack type 

\subsubsection{Function Documentation}
\hypertarget{group__template__cpu__intf_gaa097ec2ead487892969bcd2806539822}{\index{C\-P\-U port interface@{C\-P\-U port interface}!port\-Ctx\-Init@{port\-Ctx\-Init}}
\index{port\-Ctx\-Init@{port\-Ctx\-Init}!CPU port interface@{C\-P\-U port interface}}
\paragraph[{port\-Ctx\-Init}]{\setlength{\rightskip}{0pt plus 5cm}void$\ast$ port\-Ctx\-Init (
\begin{DoxyParamCaption}
\item[{void $\ast$}]{stck, }
\item[{size\-\_\-t}]{stck\-Size, }
\item[{void($\ast$)(void $\ast$)}]{fn, }
\item[{void $\ast$}]{arg}
\end{DoxyParamCaption}
)}}\label{group__template__cpu__intf_gaa097ec2ead487892969bcd2806539822}


Initialize the thread context. 


\begin{DoxyParams}{Parameters}
{\em stck} & Pointer to the allocated thread stack. The pointer points to the beginning of the memory as defined per C language. It's up to port function to adjust the pointer according to the stack type\-: full descending or full ascending one. \\
\hline
{\em stck\-Size} & The size of allocated stack in bytes. \\
\hline
{\em fn} & Pointer to the thread function. \\
\hline
{\em arg} & Argument that will be passed to thread function at the starting of execution. \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
The new top of stack after thread context initialization. 
\end{DoxyReturn}


\subsubsection{Variable Documentation}
\hypertarget{group__template__cpu__intf_gab0ad3c664e66a9a334daa4109c14e585}{\index{C\-P\-U port interface@{C\-P\-U port interface}!Port\-Isr\-Nesting@{Port\-Isr\-Nesting}}
\index{Port\-Isr\-Nesting@{Port\-Isr\-Nesting}!CPU port interface@{C\-P\-U port interface}}
\paragraph[{Port\-Isr\-Nesting}]{\setlength{\rightskip}{0pt plus 5cm}port\-Reg\-\_\-\-T Port\-Isr\-Nesting}}\label{group__template__cpu__intf_gab0ad3c664e66a9a334daa4109c14e585}


Variable to keep track of I\-S\-R nesting. 

