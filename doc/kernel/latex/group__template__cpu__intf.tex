\hypertarget{group__template__cpu__intf}{\subsection{C\-P\-U port interface}
\label{group__template__cpu__intf}\index{C\-P\-U port interface@{C\-P\-U port interface}}
}


C\-P\-U port macros and functions.  


Collaboration diagram for C\-P\-U port interface\-:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=290pt]{group__template__cpu__intf}
\end{center}
\end{figure}
\subsubsection*{Data Structures}
\begin{DoxyCompactItemize}
\item 
struct \hyperlink{structportStck}{port\-Stck}
\begin{DoxyCompactList}\small\item\em Stack structure used for stack declaration in order to force the alignment Alignment of stack structure. \end{DoxyCompactList}\item 
struct \hyperlink{structportCtx}{port\-Ctx}
\begin{DoxyCompactList}\small\item\em Port context structure. \end{DoxyCompactList}\end{DoxyCompactItemize}
\subsubsection*{Typedefs}
\begin{DoxyCompactItemize}
\item 
typedef uint8\-\_\-t \hyperlink{group__template__cpu__intf_ga99980ab56ce9857e7380210d12e3d41f}{port\-Reg\-\_\-\-T}
\begin{DoxyCompactList}\small\item\em Data type which corresponds to the general purpose register. \end{DoxyCompactList}\item 
typedef struct \hyperlink{structportStck}{port\-Stck} \hyperlink{group__template__cpu__intf_ga13cc91970e3e05fe4210440c068d3f4a}{port\-Stck\-\_\-\-T}
\begin{DoxyCompactList}\small\item\em Stack type. \end{DoxyCompactList}\end{DoxyCompactItemize}
\subsubsection*{Variables}
\begin{DoxyCompactItemize}
\item 
\hyperlink{group__template__cpu__intf_ga99980ab56ce9857e7380210d12e3d41f}{port\-Reg\-\_\-\-T} \hyperlink{group__template__cpu__intf_ga76dd98d1f19ff5ce4b4e880dfcedadb9}{g\-Port\-Isr\-Nesting\-\_\-}
\begin{DoxyCompactList}\small\item\em Variable to keep track of I\-S\-R nesting. \end{DoxyCompactList}\item 
const P\-O\-R\-T\-\_\-\-C\-\_\-\-R\-O\-M \hyperlink{group__template__cpu__intf_ga99980ab56ce9857e7380210d12e3d41f}{port\-Reg\-\_\-\-T} \hyperlink{group__template__cpu__intf_ga7c74d77135d5a694029ce4805f5dbc13}{pwr2\-L\-K\-P} \mbox{[}\hyperlink{group__template__cpu__intf_gac4d9e19c50315dec7721d4bc4d6b0605}{P\-O\-R\-T\-\_\-\-D\-A\-T\-A\-\_\-\-W\-I\-D\-T\-H\-\_\-\-V\-A\-L}\mbox{]}
\begin{DoxyCompactList}\small\item\em Look up table for\-: 2$^\wedge$n expression. \end{DoxyCompactList}\end{DoxyCompactItemize}
\subsubsection*{Port constants}
\begin{DoxyCompactItemize}
\item 
\#define \hyperlink{group__template__cpu__intf_gac4d9e19c50315dec7721d4bc4d6b0605}{P\-O\-R\-T\-\_\-\-D\-A\-T\-A\-\_\-\-W\-I\-D\-T\-H\-\_\-\-V\-A\-L}~8\-U
\begin{DoxyCompactList}\small\item\em This macro specifies the bit width of C\-P\-U data registers. \end{DoxyCompactList}\item 
\#define \hyperlink{group__template__cpu__intf_ga99f0219f12d2003e4e447fcaa06aa133}{P\-O\-R\-T\-\_\-\-S\-T\-C\-K\-\_\-\-M\-I\-N\-S\-I\-Z\-E\-\_\-\-V\-A\-L}~(sizeof(struct \hyperlink{structportCtx}{port\-Ctx}) / sizeof(\hyperlink{group__template__cpu__intf_ga99980ab56ce9857e7380210d12e3d41f}{port\-Reg\-\_\-\-T}))
\begin{DoxyCompactList}\small\item\em This macro specifies the minimal size of the thread stack. \end{DoxyCompactList}\item 
\#define \hyperlink{group__template__cpu__intf_gaa909258f3d25701e167c8dcb2a004eaf}{P\-O\-R\-T\-\_\-\-S\-Y\-S\-T\-M\-R\-\_\-\-O\-N\-E\-\_\-\-T\-I\-C\-K\-\_\-\-V\-A\-L}~(\hyperlink{group__template__cpu__cfg_gac85c592962ba2c968d13f867533196a1}{C\-F\-G\-\_\-\-S\-Y\-S\-T\-M\-R\-\_\-\-C\-L\-O\-C\-K\-\_\-\-F\-R\-E\-Q\-U\-E\-N\-C\-Y} / \hyperlink{group__template__kern__cfg_ga4e46164ae5a37bfc54c67b6f01d93eb1}{C\-F\-G\-\_\-\-S\-Y\-S\-T\-M\-R\-\_\-\-E\-V\-E\-N\-T\-\_\-\-F\-R\-E\-Q\-U\-E\-N\-C\-Y})
\begin{DoxyCompactList}\small\item\em System timer reload value for one tick. \end{DoxyCompactList}\item 
\#define \hyperlink{group__template__cpu__intf_ga5b8bb3d2476505b4379ca2b87ec22547}{P\-O\-R\-T\-\_\-\-S\-Y\-S\-T\-M\-R\-\_\-\-M\-A\-X\-\_\-\-V\-A\-L}~0x\-F\-F\-U
\begin{DoxyCompactList}\small\item\em System timer maximum value. \end{DoxyCompactList}\item 
\#define \hyperlink{group__template__cpu__intf_gad32a57bda2ce96037186e490b5a024e9}{P\-O\-R\-T\-\_\-\-S\-Y\-S\-T\-M\-R\-\_\-\-M\-A\-X\-\_\-\-T\-I\-C\-K\-S\-\_\-\-V\-A\-L}~(\hyperlink{group__template__cpu__intf_ga5b8bb3d2476505b4379ca2b87ec22547}{P\-O\-R\-T\-\_\-\-S\-Y\-S\-T\-M\-R\-\_\-\-M\-A\-X\-\_\-\-V\-A\-L} / P\-O\-R\-T\-\_\-\-S\-Y\-S\-T\-M\-R\-\_\-\-R\-E\-L\-O\-A\-D\-\_\-\-V\-A\-L)
\begin{DoxyCompactList}\small\item\em Maximum number of ticks the system timer can accept. \end{DoxyCompactList}\item 
\#define \hyperlink{group__template__cpu__intf_ga9f3862a2ded7b9fbb69f982acc020728}{P\-O\-R\-T\-\_\-\-K\-V\-T\-M\-R\-\_\-\-S\-T\-C\-K\-\_\-\-S\-I\-Z\-E}~40\-U
\begin{DoxyCompactList}\small\item\em Kernel Virtual Timer Thread stack size. \end{DoxyCompactList}\item 
\#define \hyperlink{group__template__cpu__intf_ga2cb7ea9e526744b74367bbffda625044}{P\-O\-R\-T\-\_\-\-K\-I\-D\-L\-E\-\_\-\-S\-T\-C\-K\-\_\-\-S\-I\-Z\-E}~40\-U
\begin{DoxyCompactList}\small\item\em Kernel Idle Thread stack size. \end{DoxyCompactList}\end{DoxyCompactItemize}
\subsubsection*{Interrupt management}
\label{_amgrp0762f598cbb5b37886374004ead985d4}%
P\-O\-R\-T\-\_\-\-I\-S\-R\-\_\-... macros are used by es\-Kern\-Isr\-Enter() and es\-Kern\-Isr\-Exit() functions. They are used to keep the current level of I\-S\-R nesting. Scheduler should be invoked only from the last I\-S\-R that is executing. \begin{DoxyCompactItemize}
\item 
\#define \hyperlink{group__template__cpu__intf_gac73a0b0b3d8a130a8d8283be5bba057d}{P\-O\-R\-T\-\_\-\-I\-N\-T\-\_\-\-D\-I\-S\-A\-B\-L\-E}()
\begin{DoxyCompactList}\small\item\em Disable all interrupt sources. \end{DoxyCompactList}\item 
\#define \hyperlink{group__template__cpu__intf_gaccad9298c874b29753b318d4f900cb75}{P\-O\-R\-T\-\_\-\-I\-S\-R\-\_\-\-E\-N\-T\-E\-R}()
\begin{DoxyCompactList}\small\item\em Enter I\-S\-R. Increment g\-Port\-Isr\-Nesting\-\_\- variable to keep track of I\-S\-R nesting. \end{DoxyCompactList}\item 
\#define \hyperlink{group__template__cpu__intf_ga267c312d7321e9361b454f4274bbc087}{P\-O\-R\-T\-\_\-\-I\-S\-R\-\_\-\-E\-X\-I\-T}()
\begin{DoxyCompactList}\small\item\em Exit I\-S\-R. Decrement g\-Port\-Isr\-Nesting\-\_\- variable to keep track of I\-S\-R nesting. \end{DoxyCompactList}\item 
\#define \hyperlink{group__template__cpu__intf_ga6c0ea20c8e1f6b9751f51916da8e2aee}{P\-O\-R\-T\-\_\-\-I\-S\-R\-\_\-\-I\-S\-\_\-\-L\-A\-S\-T}()~(0\-U == g\-Port\-Isr\-Nesting ? T\-R\-U\-E \-: F\-A\-L\-S\-E)
\begin{DoxyCompactList}\small\item\em If isr\-Nesting variable is zero then the last I\-S\-R is executing and scheduler should be invoked. \end{DoxyCompactList}\end{DoxyCompactItemize}
\subsubsection*{Critical section management}
\label{_amgrp43784aebc31664bf2b83e85766997ec9}%
Disable/enable interrupts by preserving the status of interrupts.

Generally speaking these macros would store the status of the interrupt disable flag in the local variable declared by \hyperlink{group__template__cpu__intf_gaecf0dc273d0d77b45baa682e0f2932ab}{P\-O\-R\-T\-\_\-\-C\-R\-I\-T\-I\-C\-A\-L\-\_\-\-D\-E\-C\-L} and then disable interrupts. Local variable is allocated in all of e\-Solid R\-T\-O\-S functions that need to disable interrupts. Macros would restore the interrupt status by copying back the allocated variable into the C\-P\-U's status register. \begin{DoxyCompactItemize}
\item 
\#define \hyperlink{group__template__cpu__intf_gaecf0dc273d0d77b45baa682e0f2932ab}{P\-O\-R\-T\-\_\-\-C\-R\-I\-T\-I\-C\-A\-L\-\_\-\-D\-E\-C\-L}()~\hyperlink{group__template__cpu__intf_ga99980ab56ce9857e7380210d12e3d41f}{port\-Reg\-\_\-\-T} int\-Status\-\_\-
\begin{DoxyCompactList}\small\item\em Declare the interrupt status variable. \end{DoxyCompactList}\item 
\#define \hyperlink{group__template__cpu__intf_gad230b116bf8bc513e64c533d4e946054}{P\-O\-R\-T\-\_\-\-C\-R\-I\-T\-I\-C\-A\-L\-\_\-\-E\-N\-T\-E\-R}()
\begin{DoxyCompactList}\small\item\em Enter critical section. \end{DoxyCompactList}\item 
\#define \hyperlink{group__template__cpu__intf_ga95082ec189f12ed8e39efbda811dea77}{P\-O\-R\-T\-\_\-\-C\-R\-I\-T\-I\-C\-A\-L\-\_\-\-E\-X\-I\-T}()
\begin{DoxyCompactList}\small\item\em Exit critical section. \end{DoxyCompactList}\end{DoxyCompactItemize}
\subsubsection*{Scheduler support}
\label{_amgrp4dcdbeafb69eec06b5ccc9a6733244b8}%
\begin{DoxyNote}{Note}
These functions are extensively used by the scheduler and therefore they should be optimized for the architecture being used. 
\end{DoxyNote}
\begin{DoxyCompactItemize}
\item 
uint\-\_\-fast8\-\_\-t \hyperlink{group__template__cpu__intf_ga548cbf806bfd34904f60a1f8db0ce965}{port\-Find\-Last\-Set\-\_\-} (\hyperlink{group__template__cpu__intf_ga99980ab56ce9857e7380210d12e3d41f}{port\-Reg\-\_\-\-T} val)
\begin{DoxyCompactList}\small\item\em Find last set bit in a word. \end{DoxyCompactList}\item 
\#define \hyperlink{group__template__cpu__intf_ga5574dfe2108fc8a4cf83647113724052}{P\-O\-R\-T\-\_\-\-F\-I\-N\-D\-\_\-\-L\-A\-S\-T\-\_\-\-S\-E\-T}(val)~\hyperlink{group__template__cpu__impl_ga548cbf806bfd34904f60a1f8db0ce965}{port\-Find\-Last\-Set\-\_\-}(val)
\begin{DoxyCompactList}\small\item\em Find last set bit in a word. \end{DoxyCompactList}\item 
\#define \hyperlink{group__template__cpu__intf_ga4b938b55e8398b93969cfb7bc64177cd}{P\-O\-R\-T\-\_\-\-P\-W\-R2}(pwr)~(1\-U $<$$<$ (pwr))
\begin{DoxyCompactList}\small\item\em Helper macro\-: calculate 2$^\wedge$pwr expression. \end{DoxyCompactList}\item 
\#define \hyperlink{group__template__cpu__intf_gae4de1f7cd0b489825c5f3d848211fa01}{P\-O\-R\-T\-\_\-\-S\-Y\-S\-T\-M\-R\-\_\-\-I\-N\-I\-T}()
\begin{DoxyCompactList}\small\item\em Initialize system timer and associated interrupt. \end{DoxyCompactList}\item 
\#define \hyperlink{group__template__cpu__intf_ga9da245ecf0f472f0e749fb360d1dd056}{P\-O\-R\-T\-\_\-\-S\-Y\-S\-T\-M\-R\-\_\-\-T\-E\-R\-M}()
\begin{DoxyCompactList}\small\item\em Stop the timer if it is running and disable associated interrupt. \end{DoxyCompactList}\item 
\#define \hyperlink{group__template__cpu__intf_ga148b9eebb96ac28f7e84b94602d3b971}{P\-O\-R\-T\-\_\-\-S\-Y\-S\-T\-M\-R\-\_\-\-G\-E\-T\-\_\-\-R\-V\-A\-L}()
\begin{DoxyCompactList}\small\item\em Get system timer reload value. \end{DoxyCompactList}\item 
\#define \hyperlink{group__template__cpu__intf_gacf78b07f0013cd7a1d06b258e37016e3}{P\-O\-R\-T\-\_\-\-S\-Y\-S\-T\-M\-R\-\_\-\-G\-E\-T\-\_\-\-C\-V\-A\-L}()
\begin{DoxyCompactList}\small\item\em Get system timer current value. \end{DoxyCompactList}\item 
\#define \hyperlink{group__template__cpu__intf_ga978c719faf8d3026aa9714561e8cd522}{P\-O\-R\-T\-\_\-\-S\-Y\-S\-T\-M\-R\-\_\-\-R\-L\-D}(val)
\begin{DoxyCompactList}\small\item\em Reload the system timer with specified number. \end{DoxyCompactList}\item 
\#define \hyperlink{group__template__cpu__intf_ga566d86ffb8459153b9bc95a7d9dfb8ca}{P\-O\-R\-T\-\_\-\-S\-Y\-S\-T\-M\-R\-\_\-\-E\-N\-A\-B\-L\-E}()
\begin{DoxyCompactList}\small\item\em Enable the system timer. \end{DoxyCompactList}\item 
\#define \hyperlink{group__template__cpu__intf_ga2a361d660165aff766184242c274fe40}{P\-O\-R\-T\-\_\-\-S\-Y\-S\-T\-M\-R\-\_\-\-D\-I\-S\-A\-B\-L\-E}()
\begin{DoxyCompactList}\small\item\em Disable the system timer. \end{DoxyCompactList}\item 
\#define \hyperlink{group__template__cpu__intf_ga3863363d274eeebcf2ad0a3887068e87}{P\-O\-R\-T\-\_\-\-S\-Y\-S\-T\-M\-R\-\_\-\-I\-S\-R\-\_\-\-E\-N\-A\-B\-L\-E}()
\begin{DoxyCompactList}\small\item\em Enable the system timer interrupt. \end{DoxyCompactList}\item 
\#define \hyperlink{group__template__cpu__intf_gac2054b84d008e800a13b0e25f93e2dd9}{P\-O\-R\-T\-\_\-\-S\-Y\-S\-T\-M\-R\-\_\-\-I\-S\-R\-\_\-\-D\-I\-S\-A\-B\-L\-E}()
\begin{DoxyCompactList}\small\item\em Disable the system timer interrupt. \end{DoxyCompactList}\end{DoxyCompactItemize}
\subsubsection*{Dispatcher context switching}
\begin{DoxyCompactItemize}
\item 
void $\ast$ \hyperlink{group__template__cpu__intf_ga91a1dc500f743c80ec573148a99add67}{port\-Ctx\-Init\-\_\-} (void $\ast$stck, size\-\_\-t stck\-Size, void($\ast$fn)(void $\ast$), void $\ast$arg)
\begin{DoxyCompactList}\small\item\em Initialize the thread context. \end{DoxyCompactList}\item 
\#define \hyperlink{group__template__cpu__intf_ga80d15a56d61c9d4e786e52006ff4ac43}{P\-O\-R\-T\-\_\-\-C\-T\-X\-\_\-\-I\-N\-I\-T}(stck, stack\-Size, thread, arg)
\begin{DoxyCompactList}\small\item\em Initialize the thread context. \end{DoxyCompactList}\item 
\#define \hyperlink{group__template__cpu__intf_ga50a3b72a7f2065922811f0d6dedda01a}{P\-O\-R\-T\-\_\-\-C\-T\-X\-\_\-\-S\-W}()
\begin{DoxyCompactList}\small\item\em Do the context switch -\/ invoked from A\-P\-I level. \end{DoxyCompactList}\item 
\#define \hyperlink{group__template__cpu__intf_ga20bba8f9c5a2f38fd7c63b9d2320e511}{P\-O\-R\-T\-\_\-\-C\-T\-X\-\_\-\-S\-W\-\_\-\-I\-S\-R}()
\begin{DoxyCompactList}\small\item\em Do the context switch -\/ invoked from I\-S\-R level. \end{DoxyCompactList}\item 
\#define \hyperlink{group__template__cpu__intf_ga07b918aaaed3cd0dbe89eb780ce3cb36}{P\-O\-R\-T\-\_\-\-T\-H\-D\-\_\-\-S\-T\-A\-R\-T}()
\begin{DoxyCompactList}\small\item\em Start the first thread. \end{DoxyCompactList}\end{DoxyCompactItemize}
\subsubsection*{General port macros}
\begin{DoxyCompactItemize}
\item 
\#define \hyperlink{group__template__cpu__intf_gacb3a46e89d327fbaf5c122fe23877b24}{P\-O\-R\-T\-\_\-\-S\-T\-C\-K\-\_\-\-S\-I\-Z\-E}(size)
\begin{DoxyCompactList}\small\item\em Calculate the stack size. \end{DoxyCompactList}\item 
\#define \hyperlink{group__template__cpu__intf_gad699a79233d442ae90a69c113e314542}{P\-O\-R\-T\-\_\-\-C\-R\-I\-T\-I\-C\-A\-L\-\_\-\-E\-X\-I\-T\-\_\-\-S\-L\-E\-E\-P}()~port\-Int\-Set\-Sleep\-Enter\-\_\-(int\-Status\-\_\-)
\begin{DoxyCompactList}\small\item\em Exit critical section and enter sleep state. \end{DoxyCompactList}\item 
\#define \hyperlink{group__template__cpu__intf_gac9622b857ad35f73ae92a44a9d0f717c}{P\-O\-R\-T\-\_\-\-I\-N\-I\-T\-\_\-\-E\-A\-R\-L\-Y}()
\begin{DoxyCompactList}\small\item\em Early port initialization. \end{DoxyCompactList}\item 
\#define \hyperlink{group__template__cpu__intf_ga0da077bab2264b11c4107f0bef279b86}{P\-O\-R\-T\-\_\-\-I\-N\-I\-T}()
\begin{DoxyCompactList}\small\item\em Port initialization. \end{DoxyCompactList}\item 
\#define \hyperlink{group__template__cpu__intf_ga8bfda2e0a8029092d0377640ba228b6d}{P\-O\-R\-T\-\_\-\-I\-N\-I\-T\-\_\-\-L\-A\-T\-E}()
\begin{DoxyCompactList}\small\item\em Late port initialization. \end{DoxyCompactList}\item 
\#define \hyperlink{group__template__cpu__intf_gab2a39b200d6e6806896ba45a9c3a9d1e}{P\-O\-R\-T\-\_\-\-T\-E\-R\-M}()
\begin{DoxyCompactList}\small\item\em Terminate port. \end{DoxyCompactList}\end{DoxyCompactItemize}


\subsubsection{Detailed Description}
C\-P\-U port macros and functions. Since this header file is included with the A\-P\-I of the kernel a few naming conventions are defined in order to avoid name clashing with the names of objects from libraries included by application code.

\begin{DoxyParagraph}{1) Macro naming conventions}
For macro naming try to follow these rules\-:
\begin{DoxyItemize}
\item All standard P\-O\-R\-T A\-P\-I macro names are prefixed with\-: {\bfseries {\ttfamily P\-O\-R\-T\-\_\-}.} 
\item All other macros which are specific to the port used are prefixed with\-: {\bfseries {\ttfamily C\-P\-U\-\_\-}.} 
\end{DoxyItemize}
\end{DoxyParagraph}
\begin{DoxyParagraph}{2) Type declaration naming conventions}
For type declaration naming try to follow these rules\-:
\begin{DoxyItemize}
\item All type declaration names are prefixed with\-: {\bfseries {\ttfamily cpu}.} 
\end{DoxyItemize}
\end{DoxyParagraph}
\begin{DoxyParagraph}{3) Global variable naming conventions}
For global variable naming try to follow these rules\-:
\begin{DoxyItemize}
\item All global variable names are prefixed with\-: {\bfseries {\ttfamily cpu}.} 
\end{DoxyItemize}
\end{DoxyParagraph}
\begin{DoxyParagraph}{4) Funcion naming convetions}
For functions naming try to follow these rules\-:
\begin{DoxyItemize}
\item All function names are prefixed with\-: {\bfseries {\ttfamily port}} and postfixed with\-: {\bfseries {\ttfamily \-\_\-} }(underscore).
\item All other functions which are specific to the port used are prefixed with\-: {\bfseries {\ttfamily cpu}} and postfixed with\-: {\bfseries {\ttfamily \-\_\-} }(underscore).
\item The {\ttfamily exception} to above two rules are the names of functions used for Interrupt Service Routines. They can have any name required by port. 
\end{DoxyItemize}
\end{DoxyParagraph}


\subsubsection{Macro Definition Documentation}
\hypertarget{group__template__cpu__intf_gac4d9e19c50315dec7721d4bc4d6b0605}{\index{C\-P\-U port interface@{C\-P\-U port interface}!P\-O\-R\-T\-\_\-\-D\-A\-T\-A\-\_\-\-W\-I\-D\-T\-H\-\_\-\-V\-A\-L@{P\-O\-R\-T\-\_\-\-D\-A\-T\-A\-\_\-\-W\-I\-D\-T\-H\-\_\-\-V\-A\-L}}
\index{P\-O\-R\-T\-\_\-\-D\-A\-T\-A\-\_\-\-W\-I\-D\-T\-H\-\_\-\-V\-A\-L@{P\-O\-R\-T\-\_\-\-D\-A\-T\-A\-\_\-\-W\-I\-D\-T\-H\-\_\-\-V\-A\-L}!CPU port interface@{C\-P\-U port interface}}
\paragraph[{P\-O\-R\-T\-\_\-\-D\-A\-T\-A\-\_\-\-W\-I\-D\-T\-H\-\_\-\-V\-A\-L}]{\setlength{\rightskip}{0pt plus 5cm}\#define P\-O\-R\-T\-\_\-\-D\-A\-T\-A\-\_\-\-W\-I\-D\-T\-H\-\_\-\-V\-A\-L~8\-U}}\label{group__template__cpu__intf_gac4d9e19c50315dec7721d4bc4d6b0605}


This macro specifies the bit width of C\-P\-U data registers. 

\hypertarget{group__template__cpu__intf_ga99f0219f12d2003e4e447fcaa06aa133}{\index{C\-P\-U port interface@{C\-P\-U port interface}!P\-O\-R\-T\-\_\-\-S\-T\-C\-K\-\_\-\-M\-I\-N\-S\-I\-Z\-E\-\_\-\-V\-A\-L@{P\-O\-R\-T\-\_\-\-S\-T\-C\-K\-\_\-\-M\-I\-N\-S\-I\-Z\-E\-\_\-\-V\-A\-L}}
\index{P\-O\-R\-T\-\_\-\-S\-T\-C\-K\-\_\-\-M\-I\-N\-S\-I\-Z\-E\-\_\-\-V\-A\-L@{P\-O\-R\-T\-\_\-\-S\-T\-C\-K\-\_\-\-M\-I\-N\-S\-I\-Z\-E\-\_\-\-V\-A\-L}!CPU port interface@{C\-P\-U port interface}}
\paragraph[{P\-O\-R\-T\-\_\-\-S\-T\-C\-K\-\_\-\-M\-I\-N\-S\-I\-Z\-E\-\_\-\-V\-A\-L}]{\setlength{\rightskip}{0pt plus 5cm}\#define P\-O\-R\-T\-\_\-\-S\-T\-C\-K\-\_\-\-M\-I\-N\-S\-I\-Z\-E\-\_\-\-V\-A\-L~(sizeof(struct {\bf port\-Ctx}) / sizeof({\bf port\-Reg\-\_\-\-T}))}}\label{group__template__cpu__intf_ga99f0219f12d2003e4e447fcaa06aa133}


This macro specifies the minimal size of the thread stack. 

Generally minimal stack size is equal to the size of context structure \hypertarget{group__template__cpu__intf_gaa909258f3d25701e167c8dcb2a004eaf}{\index{C\-P\-U port interface@{C\-P\-U port interface}!P\-O\-R\-T\-\_\-\-S\-Y\-S\-T\-M\-R\-\_\-\-O\-N\-E\-\_\-\-T\-I\-C\-K\-\_\-\-V\-A\-L@{P\-O\-R\-T\-\_\-\-S\-Y\-S\-T\-M\-R\-\_\-\-O\-N\-E\-\_\-\-T\-I\-C\-K\-\_\-\-V\-A\-L}}
\index{P\-O\-R\-T\-\_\-\-S\-Y\-S\-T\-M\-R\-\_\-\-O\-N\-E\-\_\-\-T\-I\-C\-K\-\_\-\-V\-A\-L@{P\-O\-R\-T\-\_\-\-S\-Y\-S\-T\-M\-R\-\_\-\-O\-N\-E\-\_\-\-T\-I\-C\-K\-\_\-\-V\-A\-L}!CPU port interface@{C\-P\-U port interface}}
\paragraph[{P\-O\-R\-T\-\_\-\-S\-Y\-S\-T\-M\-R\-\_\-\-O\-N\-E\-\_\-\-T\-I\-C\-K\-\_\-\-V\-A\-L}]{\setlength{\rightskip}{0pt plus 5cm}\#define P\-O\-R\-T\-\_\-\-S\-Y\-S\-T\-M\-R\-\_\-\-O\-N\-E\-\_\-\-T\-I\-C\-K\-\_\-\-V\-A\-L~({\bf C\-F\-G\-\_\-\-S\-Y\-S\-T\-M\-R\-\_\-\-C\-L\-O\-C\-K\-\_\-\-F\-R\-E\-Q\-U\-E\-N\-C\-Y} / {\bf C\-F\-G\-\_\-\-S\-Y\-S\-T\-M\-R\-\_\-\-E\-V\-E\-N\-T\-\_\-\-F\-R\-E\-Q\-U\-E\-N\-C\-Y})}}\label{group__template__cpu__intf_gaa909258f3d25701e167c8dcb2a004eaf}


System timer reload value for one tick. 

This is a calculated value for one system tick period \hypertarget{group__template__cpu__intf_ga5b8bb3d2476505b4379ca2b87ec22547}{\index{C\-P\-U port interface@{C\-P\-U port interface}!P\-O\-R\-T\-\_\-\-S\-Y\-S\-T\-M\-R\-\_\-\-M\-A\-X\-\_\-\-V\-A\-L@{P\-O\-R\-T\-\_\-\-S\-Y\-S\-T\-M\-R\-\_\-\-M\-A\-X\-\_\-\-V\-A\-L}}
\index{P\-O\-R\-T\-\_\-\-S\-Y\-S\-T\-M\-R\-\_\-\-M\-A\-X\-\_\-\-V\-A\-L@{P\-O\-R\-T\-\_\-\-S\-Y\-S\-T\-M\-R\-\_\-\-M\-A\-X\-\_\-\-V\-A\-L}!CPU port interface@{C\-P\-U port interface}}
\paragraph[{P\-O\-R\-T\-\_\-\-S\-Y\-S\-T\-M\-R\-\_\-\-M\-A\-X\-\_\-\-V\-A\-L}]{\setlength{\rightskip}{0pt plus 5cm}\#define P\-O\-R\-T\-\_\-\-S\-Y\-S\-T\-M\-R\-\_\-\-M\-A\-X\-\_\-\-V\-A\-L~0x\-F\-F\-U}}\label{group__template__cpu__intf_ga5b8bb3d2476505b4379ca2b87ec22547}


System timer maximum value. 

This macro specifies maximum value that can be reloaded into system timer counter. For example, if the system timer is a 8-\/bit counter than this macro would have the value of 0x\-F\-F\-U. \hypertarget{group__template__cpu__intf_gad32a57bda2ce96037186e490b5a024e9}{\index{C\-P\-U port interface@{C\-P\-U port interface}!P\-O\-R\-T\-\_\-\-S\-Y\-S\-T\-M\-R\-\_\-\-M\-A\-X\-\_\-\-T\-I\-C\-K\-S\-\_\-\-V\-A\-L@{P\-O\-R\-T\-\_\-\-S\-Y\-S\-T\-M\-R\-\_\-\-M\-A\-X\-\_\-\-T\-I\-C\-K\-S\-\_\-\-V\-A\-L}}
\index{P\-O\-R\-T\-\_\-\-S\-Y\-S\-T\-M\-R\-\_\-\-M\-A\-X\-\_\-\-T\-I\-C\-K\-S\-\_\-\-V\-A\-L@{P\-O\-R\-T\-\_\-\-S\-Y\-S\-T\-M\-R\-\_\-\-M\-A\-X\-\_\-\-T\-I\-C\-K\-S\-\_\-\-V\-A\-L}!CPU port interface@{C\-P\-U port interface}}
\paragraph[{P\-O\-R\-T\-\_\-\-S\-Y\-S\-T\-M\-R\-\_\-\-M\-A\-X\-\_\-\-T\-I\-C\-K\-S\-\_\-\-V\-A\-L}]{\setlength{\rightskip}{0pt plus 5cm}\#define P\-O\-R\-T\-\_\-\-S\-Y\-S\-T\-M\-R\-\_\-\-M\-A\-X\-\_\-\-T\-I\-C\-K\-S\-\_\-\-V\-A\-L~({\bf P\-O\-R\-T\-\_\-\-S\-Y\-S\-T\-M\-R\-\_\-\-M\-A\-X\-\_\-\-V\-A\-L} / P\-O\-R\-T\-\_\-\-S\-Y\-S\-T\-M\-R\-\_\-\-R\-E\-L\-O\-A\-D\-\_\-\-V\-A\-L)}}\label{group__template__cpu__intf_gad32a57bda2ce96037186e490b5a024e9}


Maximum number of ticks the system timer can accept. 

\hypertarget{group__template__cpu__intf_ga9f3862a2ded7b9fbb69f982acc020728}{\index{C\-P\-U port interface@{C\-P\-U port interface}!P\-O\-R\-T\-\_\-\-K\-V\-T\-M\-R\-\_\-\-S\-T\-C\-K\-\_\-\-S\-I\-Z\-E@{P\-O\-R\-T\-\_\-\-K\-V\-T\-M\-R\-\_\-\-S\-T\-C\-K\-\_\-\-S\-I\-Z\-E}}
\index{P\-O\-R\-T\-\_\-\-K\-V\-T\-M\-R\-\_\-\-S\-T\-C\-K\-\_\-\-S\-I\-Z\-E@{P\-O\-R\-T\-\_\-\-K\-V\-T\-M\-R\-\_\-\-S\-T\-C\-K\-\_\-\-S\-I\-Z\-E}!CPU port interface@{C\-P\-U port interface}}
\paragraph[{P\-O\-R\-T\-\_\-\-K\-V\-T\-M\-R\-\_\-\-S\-T\-C\-K\-\_\-\-S\-I\-Z\-E}]{\setlength{\rightskip}{0pt plus 5cm}\#define P\-O\-R\-T\-\_\-\-K\-V\-T\-M\-R\-\_\-\-S\-T\-C\-K\-\_\-\-S\-I\-Z\-E~40\-U}}\label{group__template__cpu__intf_ga9f3862a2ded7b9fbb69f982acc020728}


Kernel Virtual Timer Thread stack size. 

\hypertarget{group__template__cpu__intf_ga2cb7ea9e526744b74367bbffda625044}{\index{C\-P\-U port interface@{C\-P\-U port interface}!P\-O\-R\-T\-\_\-\-K\-I\-D\-L\-E\-\_\-\-S\-T\-C\-K\-\_\-\-S\-I\-Z\-E@{P\-O\-R\-T\-\_\-\-K\-I\-D\-L\-E\-\_\-\-S\-T\-C\-K\-\_\-\-S\-I\-Z\-E}}
\index{P\-O\-R\-T\-\_\-\-K\-I\-D\-L\-E\-\_\-\-S\-T\-C\-K\-\_\-\-S\-I\-Z\-E@{P\-O\-R\-T\-\_\-\-K\-I\-D\-L\-E\-\_\-\-S\-T\-C\-K\-\_\-\-S\-I\-Z\-E}!CPU port interface@{C\-P\-U port interface}}
\paragraph[{P\-O\-R\-T\-\_\-\-K\-I\-D\-L\-E\-\_\-\-S\-T\-C\-K\-\_\-\-S\-I\-Z\-E}]{\setlength{\rightskip}{0pt plus 5cm}\#define P\-O\-R\-T\-\_\-\-K\-I\-D\-L\-E\-\_\-\-S\-T\-C\-K\-\_\-\-S\-I\-Z\-E~40\-U}}\label{group__template__cpu__intf_ga2cb7ea9e526744b74367bbffda625044}


Kernel Idle Thread stack size. 

\hypertarget{group__template__cpu__intf_gac73a0b0b3d8a130a8d8283be5bba057d}{\index{C\-P\-U port interface@{C\-P\-U port interface}!P\-O\-R\-T\-\_\-\-I\-N\-T\-\_\-\-D\-I\-S\-A\-B\-L\-E@{P\-O\-R\-T\-\_\-\-I\-N\-T\-\_\-\-D\-I\-S\-A\-B\-L\-E}}
\index{P\-O\-R\-T\-\_\-\-I\-N\-T\-\_\-\-D\-I\-S\-A\-B\-L\-E@{P\-O\-R\-T\-\_\-\-I\-N\-T\-\_\-\-D\-I\-S\-A\-B\-L\-E}!CPU port interface@{C\-P\-U port interface}}
\paragraph[{P\-O\-R\-T\-\_\-\-I\-N\-T\-\_\-\-D\-I\-S\-A\-B\-L\-E}]{\setlength{\rightskip}{0pt plus 5cm}\#define P\-O\-R\-T\-\_\-\-I\-N\-T\-\_\-\-D\-I\-S\-A\-B\-L\-E(
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{group__template__cpu__intf_gac73a0b0b3d8a130a8d8283be5bba057d}


Disable all interrupt sources. 

\hypertarget{group__template__cpu__intf_gaccad9298c874b29753b318d4f900cb75}{\index{C\-P\-U port interface@{C\-P\-U port interface}!P\-O\-R\-T\-\_\-\-I\-S\-R\-\_\-\-E\-N\-T\-E\-R@{P\-O\-R\-T\-\_\-\-I\-S\-R\-\_\-\-E\-N\-T\-E\-R}}
\index{P\-O\-R\-T\-\_\-\-I\-S\-R\-\_\-\-E\-N\-T\-E\-R@{P\-O\-R\-T\-\_\-\-I\-S\-R\-\_\-\-E\-N\-T\-E\-R}!CPU port interface@{C\-P\-U port interface}}
\paragraph[{P\-O\-R\-T\-\_\-\-I\-S\-R\-\_\-\-E\-N\-T\-E\-R}]{\setlength{\rightskip}{0pt plus 5cm}\#define P\-O\-R\-T\-\_\-\-I\-S\-R\-\_\-\-E\-N\-T\-E\-R(
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{group__template__cpu__intf_gaccad9298c874b29753b318d4f900cb75}
{\bfseries Value\-:}
\begin{DoxyCode}
\textcolor{keywordflow}{do} \{                                                                        \hyperlink{group__template__cpu__intf_ga76dd98d1f19ff5ce4b4e880dfcedadb9}{\(\backslash\)}
\hyperlink{group__template__cpu__intf_ga76dd98d1f19ff5ce4b4e880dfcedadb9}{        gPortIsrNesting\_}++;                                                     
      \hyperlink{group__kern__intf_ga194f9cbc5398fe0938504a378fcff810}{\(\backslash\)}
\hyperlink{group__kern__intf_ga194f9cbc5398fe0938504a378fcff810}{        esKernIsrPrologueI}();                                                   \(\backslash\)
    \} \textcolor{keywordflow}{while} (0U)
\end{DoxyCode}


Enter I\-S\-R. Increment g\-Port\-Isr\-Nesting\-\_\- variable to keep track of I\-S\-R nesting. 

Variable g\-Port\-Isr\-Nesting\-\_\- is needed only if the port does not support any other method of detecting when the last I\-S\-R is executing. \hypertarget{group__template__cpu__intf_ga267c312d7321e9361b454f4274bbc087}{\index{C\-P\-U port interface@{C\-P\-U port interface}!P\-O\-R\-T\-\_\-\-I\-S\-R\-\_\-\-E\-X\-I\-T@{P\-O\-R\-T\-\_\-\-I\-S\-R\-\_\-\-E\-X\-I\-T}}
\index{P\-O\-R\-T\-\_\-\-I\-S\-R\-\_\-\-E\-X\-I\-T@{P\-O\-R\-T\-\_\-\-I\-S\-R\-\_\-\-E\-X\-I\-T}!CPU port interface@{C\-P\-U port interface}}
\paragraph[{P\-O\-R\-T\-\_\-\-I\-S\-R\-\_\-\-E\-X\-I\-T}]{\setlength{\rightskip}{0pt plus 5cm}\#define P\-O\-R\-T\-\_\-\-I\-S\-R\-\_\-\-E\-X\-I\-T(
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{group__template__cpu__intf_ga267c312d7321e9361b454f4274bbc087}
{\bfseries Value\-:}
\begin{DoxyCode}
\textcolor{keywordflow}{do} \{                                                                        \hyperlink{group__template__cpu__intf_ga76dd98d1f19ff5ce4b4e880dfcedadb9}{\(\backslash\)}
\hyperlink{group__template__cpu__intf_ga76dd98d1f19ff5ce4b4e880dfcedadb9}{        gPortIsrNesting\_}--;                                                     
      \hyperlink{group__kern__intf_ga62d9b43eb8faf6c5df37e7b89811ac8d}{\(\backslash\)}
\hyperlink{group__kern__intf_ga62d9b43eb8faf6c5df37e7b89811ac8d}{        esKernIsrEpilogueI}();                                                   \(\backslash\)
    \} \textcolor{keywordflow}{while} (0U)
\end{DoxyCode}


Exit I\-S\-R. Decrement g\-Port\-Isr\-Nesting\-\_\- variable to keep track of I\-S\-R nesting. 

Variable g\-Port\-Isr\-Nesting\-\_\- is needed only if the port does not support any other method of detecting when the last I\-S\-R is executing. \hypertarget{group__template__cpu__intf_ga6c0ea20c8e1f6b9751f51916da8e2aee}{\index{C\-P\-U port interface@{C\-P\-U port interface}!P\-O\-R\-T\-\_\-\-I\-S\-R\-\_\-\-I\-S\-\_\-\-L\-A\-S\-T@{P\-O\-R\-T\-\_\-\-I\-S\-R\-\_\-\-I\-S\-\_\-\-L\-A\-S\-T}}
\index{P\-O\-R\-T\-\_\-\-I\-S\-R\-\_\-\-I\-S\-\_\-\-L\-A\-S\-T@{P\-O\-R\-T\-\_\-\-I\-S\-R\-\_\-\-I\-S\-\_\-\-L\-A\-S\-T}!CPU port interface@{C\-P\-U port interface}}
\paragraph[{P\-O\-R\-T\-\_\-\-I\-S\-R\-\_\-\-I\-S\-\_\-\-L\-A\-S\-T}]{\setlength{\rightskip}{0pt plus 5cm}\#define P\-O\-R\-T\-\_\-\-I\-S\-R\-\_\-\-I\-S\-\_\-\-L\-A\-S\-T(
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)~(0\-U == g\-Port\-Isr\-Nesting ? T\-R\-U\-E \-: F\-A\-L\-S\-E)}}\label{group__template__cpu__intf_ga6c0ea20c8e1f6b9751f51916da8e2aee}


If isr\-Nesting variable is zero then the last I\-S\-R is executing and scheduler should be invoked. 

\begin{DoxyReturn}{Returns}
Is the currently executed I\-S\-R the last one? 
\end{DoxyReturn}

\begin{DoxyRetVals}{Return values}
{\em T\-R\-U\-E} & -\/ this is last I\-S\-R \\
\hline
{\em F\-A\-L\-S\-E} & -\/ this is not the last I\-S\-R \\
\hline
\end{DoxyRetVals}
\hypertarget{group__template__cpu__intf_gaecf0dc273d0d77b45baa682e0f2932ab}{\index{C\-P\-U port interface@{C\-P\-U port interface}!P\-O\-R\-T\-\_\-\-C\-R\-I\-T\-I\-C\-A\-L\-\_\-\-D\-E\-C\-L@{P\-O\-R\-T\-\_\-\-C\-R\-I\-T\-I\-C\-A\-L\-\_\-\-D\-E\-C\-L}}
\index{P\-O\-R\-T\-\_\-\-C\-R\-I\-T\-I\-C\-A\-L\-\_\-\-D\-E\-C\-L@{P\-O\-R\-T\-\_\-\-C\-R\-I\-T\-I\-C\-A\-L\-\_\-\-D\-E\-C\-L}!CPU port interface@{C\-P\-U port interface}}
\paragraph[{P\-O\-R\-T\-\_\-\-C\-R\-I\-T\-I\-C\-A\-L\-\_\-\-D\-E\-C\-L}]{\setlength{\rightskip}{0pt plus 5cm}\#define P\-O\-R\-T\-\_\-\-C\-R\-I\-T\-I\-C\-A\-L\-\_\-\-D\-E\-C\-L(
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)~{\bf port\-Reg\-\_\-\-T} int\-Status\-\_\-}}\label{group__template__cpu__intf_gaecf0dc273d0d77b45baa682e0f2932ab}


Declare the interrupt status variable. 

This variable is used to store the current state of enabled I\-S\-Rs. \hypertarget{group__template__cpu__intf_gad230b116bf8bc513e64c533d4e946054}{\index{C\-P\-U port interface@{C\-P\-U port interface}!P\-O\-R\-T\-\_\-\-C\-R\-I\-T\-I\-C\-A\-L\-\_\-\-E\-N\-T\-E\-R@{P\-O\-R\-T\-\_\-\-C\-R\-I\-T\-I\-C\-A\-L\-\_\-\-E\-N\-T\-E\-R}}
\index{P\-O\-R\-T\-\_\-\-C\-R\-I\-T\-I\-C\-A\-L\-\_\-\-E\-N\-T\-E\-R@{P\-O\-R\-T\-\_\-\-C\-R\-I\-T\-I\-C\-A\-L\-\_\-\-E\-N\-T\-E\-R}!CPU port interface@{C\-P\-U port interface}}
\paragraph[{P\-O\-R\-T\-\_\-\-C\-R\-I\-T\-I\-C\-A\-L\-\_\-\-E\-N\-T\-E\-R}]{\setlength{\rightskip}{0pt plus 5cm}\#define P\-O\-R\-T\-\_\-\-C\-R\-I\-T\-I\-C\-A\-L\-\_\-\-E\-N\-T\-E\-R(
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{group__template__cpu__intf_gad230b116bf8bc513e64c533d4e946054}


Enter critical section. 

\hypertarget{group__template__cpu__intf_ga95082ec189f12ed8e39efbda811dea77}{\index{C\-P\-U port interface@{C\-P\-U port interface}!P\-O\-R\-T\-\_\-\-C\-R\-I\-T\-I\-C\-A\-L\-\_\-\-E\-X\-I\-T@{P\-O\-R\-T\-\_\-\-C\-R\-I\-T\-I\-C\-A\-L\-\_\-\-E\-X\-I\-T}}
\index{P\-O\-R\-T\-\_\-\-C\-R\-I\-T\-I\-C\-A\-L\-\_\-\-E\-X\-I\-T@{P\-O\-R\-T\-\_\-\-C\-R\-I\-T\-I\-C\-A\-L\-\_\-\-E\-X\-I\-T}!CPU port interface@{C\-P\-U port interface}}
\paragraph[{P\-O\-R\-T\-\_\-\-C\-R\-I\-T\-I\-C\-A\-L\-\_\-\-E\-X\-I\-T}]{\setlength{\rightskip}{0pt plus 5cm}\#define P\-O\-R\-T\-\_\-\-C\-R\-I\-T\-I\-C\-A\-L\-\_\-\-E\-X\-I\-T(
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{group__template__cpu__intf_ga95082ec189f12ed8e39efbda811dea77}


Exit critical section. 

\hypertarget{group__template__cpu__intf_ga5574dfe2108fc8a4cf83647113724052}{\index{C\-P\-U port interface@{C\-P\-U port interface}!P\-O\-R\-T\-\_\-\-F\-I\-N\-D\-\_\-\-L\-A\-S\-T\-\_\-\-S\-E\-T@{P\-O\-R\-T\-\_\-\-F\-I\-N\-D\-\_\-\-L\-A\-S\-T\-\_\-\-S\-E\-T}}
\index{P\-O\-R\-T\-\_\-\-F\-I\-N\-D\-\_\-\-L\-A\-S\-T\-\_\-\-S\-E\-T@{P\-O\-R\-T\-\_\-\-F\-I\-N\-D\-\_\-\-L\-A\-S\-T\-\_\-\-S\-E\-T}!CPU port interface@{C\-P\-U port interface}}
\paragraph[{P\-O\-R\-T\-\_\-\-F\-I\-N\-D\-\_\-\-L\-A\-S\-T\-\_\-\-S\-E\-T}]{\setlength{\rightskip}{0pt plus 5cm}\#define P\-O\-R\-T\-\_\-\-F\-I\-N\-D\-\_\-\-L\-A\-S\-T\-\_\-\-S\-E\-T(
\begin{DoxyParamCaption}
\item[{}]{val}
\end{DoxyParamCaption}
)~{\bf port\-Find\-Last\-Set\-\_\-}(val)}}\label{group__template__cpu__intf_ga5574dfe2108fc8a4cf83647113724052}


Find last set bit in a word. 

This function is used by the scheduler to efficiently determine the highest priority of thread ready for execution. For algorithm details see\-: \href{http://en.wikipedia.org/wiki/Find_first_set}{\tt http\-://en.\-wikipedia.\-org/wiki/\-Find\-\_\-first\-\_\-set}. \begin{DoxyReturn}{Returns}
The position of the last set bit in a word 
\end{DoxyReturn}
\hypertarget{group__template__cpu__intf_ga4b938b55e8398b93969cfb7bc64177cd}{\index{C\-P\-U port interface@{C\-P\-U port interface}!P\-O\-R\-T\-\_\-\-P\-W\-R2@{P\-O\-R\-T\-\_\-\-P\-W\-R2}}
\index{P\-O\-R\-T\-\_\-\-P\-W\-R2@{P\-O\-R\-T\-\_\-\-P\-W\-R2}!CPU port interface@{C\-P\-U port interface}}
\paragraph[{P\-O\-R\-T\-\_\-\-P\-W\-R2}]{\setlength{\rightskip}{0pt plus 5cm}\#define P\-O\-R\-T\-\_\-\-P\-W\-R2(
\begin{DoxyParamCaption}
\item[{}]{pwr}
\end{DoxyParamCaption}
)~(1\-U $<$$<$ (pwr))}}\label{group__template__cpu__intf_ga4b938b55e8398b93969cfb7bc64177cd}


Helper macro\-: calculate 2$^\wedge$pwr expression. 

Some ports may want to use look up tables instead of shifting operation \hypertarget{group__template__cpu__intf_gae4de1f7cd0b489825c5f3d848211fa01}{\index{C\-P\-U port interface@{C\-P\-U port interface}!P\-O\-R\-T\-\_\-\-S\-Y\-S\-T\-M\-R\-\_\-\-I\-N\-I\-T@{P\-O\-R\-T\-\_\-\-S\-Y\-S\-T\-M\-R\-\_\-\-I\-N\-I\-T}}
\index{P\-O\-R\-T\-\_\-\-S\-Y\-S\-T\-M\-R\-\_\-\-I\-N\-I\-T@{P\-O\-R\-T\-\_\-\-S\-Y\-S\-T\-M\-R\-\_\-\-I\-N\-I\-T}!CPU port interface@{C\-P\-U port interface}}
\paragraph[{P\-O\-R\-T\-\_\-\-S\-Y\-S\-T\-M\-R\-\_\-\-I\-N\-I\-T}]{\setlength{\rightskip}{0pt plus 5cm}\#define P\-O\-R\-T\-\_\-\-S\-Y\-S\-T\-M\-R\-\_\-\-I\-N\-I\-T(
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{group__template__cpu__intf_gae4de1f7cd0b489825c5f3d848211fa01}


Initialize system timer and associated interrupt. 

This macro will only initialize system timer and associated interrupt. The macro is called from \hyperlink{group__kern__intf_ga0e7a0a6b9c02df58de0f98de0229a09d}{es\-Kern\-Start()} function. Responsibility\-:
\begin{DoxyItemize}
\item initialize system timer
\item initialize system timer interrupt \begin{DoxyNote}{Note}
This macro M\-U\-S\-T N\-O\-T enable system timer events. System timer events are enabled/disabled by \hyperlink{group__template__cpu__intf_ga3863363d274eeebcf2ad0a3887068e87}{P\-O\-R\-T\-\_\-\-S\-Y\-S\-T\-M\-R\-\_\-\-I\-S\-R\-\_\-\-E\-N\-A\-B\-L\-E()} and \hyperlink{group__template__cpu__intf_gac2054b84d008e800a13b0e25f93e2dd9}{P\-O\-R\-T\-\_\-\-S\-Y\-S\-T\-M\-R\-\_\-\-I\-S\-R\-\_\-\-D\-I\-S\-A\-B\-L\-E()} macros. 
\end{DoxyNote}

\end{DoxyItemize}\hypertarget{group__template__cpu__intf_ga9da245ecf0f472f0e749fb360d1dd056}{\index{C\-P\-U port interface@{C\-P\-U port interface}!P\-O\-R\-T\-\_\-\-S\-Y\-S\-T\-M\-R\-\_\-\-T\-E\-R\-M@{P\-O\-R\-T\-\_\-\-S\-Y\-S\-T\-M\-R\-\_\-\-T\-E\-R\-M}}
\index{P\-O\-R\-T\-\_\-\-S\-Y\-S\-T\-M\-R\-\_\-\-T\-E\-R\-M@{P\-O\-R\-T\-\_\-\-S\-Y\-S\-T\-M\-R\-\_\-\-T\-E\-R\-M}!CPU port interface@{C\-P\-U port interface}}
\paragraph[{P\-O\-R\-T\-\_\-\-S\-Y\-S\-T\-M\-R\-\_\-\-T\-E\-R\-M}]{\setlength{\rightskip}{0pt plus 5cm}\#define P\-O\-R\-T\-\_\-\-S\-Y\-S\-T\-M\-R\-\_\-\-T\-E\-R\-M(
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{group__template__cpu__intf_ga9da245ecf0f472f0e749fb360d1dd056}


Stop the timer if it is running and disable associated interrupt. 

Responsibility\-:
\begin{DoxyItemize}
\item disable system timer interrupt
\item stop and disable system timer 
\end{DoxyItemize}\hypertarget{group__template__cpu__intf_ga148b9eebb96ac28f7e84b94602d3b971}{\index{C\-P\-U port interface@{C\-P\-U port interface}!P\-O\-R\-T\-\_\-\-S\-Y\-S\-T\-M\-R\-\_\-\-G\-E\-T\-\_\-\-R\-V\-A\-L@{P\-O\-R\-T\-\_\-\-S\-Y\-S\-T\-M\-R\-\_\-\-G\-E\-T\-\_\-\-R\-V\-A\-L}}
\index{P\-O\-R\-T\-\_\-\-S\-Y\-S\-T\-M\-R\-\_\-\-G\-E\-T\-\_\-\-R\-V\-A\-L@{P\-O\-R\-T\-\_\-\-S\-Y\-S\-T\-M\-R\-\_\-\-G\-E\-T\-\_\-\-R\-V\-A\-L}!CPU port interface@{C\-P\-U port interface}}
\paragraph[{P\-O\-R\-T\-\_\-\-S\-Y\-S\-T\-M\-R\-\_\-\-G\-E\-T\-\_\-\-R\-V\-A\-L}]{\setlength{\rightskip}{0pt plus 5cm}\#define P\-O\-R\-T\-\_\-\-S\-Y\-S\-T\-M\-R\-\_\-\-G\-E\-T\-\_\-\-R\-V\-A\-L(
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{group__template__cpu__intf_ga148b9eebb96ac28f7e84b94602d3b971}


Get system timer reload value. 

\hypertarget{group__template__cpu__intf_gacf78b07f0013cd7a1d06b258e37016e3}{\index{C\-P\-U port interface@{C\-P\-U port interface}!P\-O\-R\-T\-\_\-\-S\-Y\-S\-T\-M\-R\-\_\-\-G\-E\-T\-\_\-\-C\-V\-A\-L@{P\-O\-R\-T\-\_\-\-S\-Y\-S\-T\-M\-R\-\_\-\-G\-E\-T\-\_\-\-C\-V\-A\-L}}
\index{P\-O\-R\-T\-\_\-\-S\-Y\-S\-T\-M\-R\-\_\-\-G\-E\-T\-\_\-\-C\-V\-A\-L@{P\-O\-R\-T\-\_\-\-S\-Y\-S\-T\-M\-R\-\_\-\-G\-E\-T\-\_\-\-C\-V\-A\-L}!CPU port interface@{C\-P\-U port interface}}
\paragraph[{P\-O\-R\-T\-\_\-\-S\-Y\-S\-T\-M\-R\-\_\-\-G\-E\-T\-\_\-\-C\-V\-A\-L}]{\setlength{\rightskip}{0pt plus 5cm}\#define P\-O\-R\-T\-\_\-\-S\-Y\-S\-T\-M\-R\-\_\-\-G\-E\-T\-\_\-\-C\-V\-A\-L(
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{group__template__cpu__intf_gacf78b07f0013cd7a1d06b258e37016e3}


Get system timer current value. 

\hypertarget{group__template__cpu__intf_ga978c719faf8d3026aa9714561e8cd522}{\index{C\-P\-U port interface@{C\-P\-U port interface}!P\-O\-R\-T\-\_\-\-S\-Y\-S\-T\-M\-R\-\_\-\-R\-L\-D@{P\-O\-R\-T\-\_\-\-S\-Y\-S\-T\-M\-R\-\_\-\-R\-L\-D}}
\index{P\-O\-R\-T\-\_\-\-S\-Y\-S\-T\-M\-R\-\_\-\-R\-L\-D@{P\-O\-R\-T\-\_\-\-S\-Y\-S\-T\-M\-R\-\_\-\-R\-L\-D}!CPU port interface@{C\-P\-U port interface}}
\paragraph[{P\-O\-R\-T\-\_\-\-S\-Y\-S\-T\-M\-R\-\_\-\-R\-L\-D}]{\setlength{\rightskip}{0pt plus 5cm}\#define P\-O\-R\-T\-\_\-\-S\-Y\-S\-T\-M\-R\-\_\-\-R\-L\-D(
\begin{DoxyParamCaption}
\item[{}]{val}
\end{DoxyParamCaption}
)}}\label{group__template__cpu__intf_ga978c719faf8d3026aa9714561e8cd522}


Reload the system timer with specified number. 

Responsibility\-:
\begin{DoxyItemize}
\item stop the system timer
\item reload the system timer
\item start the system timer 
\end{DoxyItemize}\hypertarget{group__template__cpu__intf_ga566d86ffb8459153b9bc95a7d9dfb8ca}{\index{C\-P\-U port interface@{C\-P\-U port interface}!P\-O\-R\-T\-\_\-\-S\-Y\-S\-T\-M\-R\-\_\-\-E\-N\-A\-B\-L\-E@{P\-O\-R\-T\-\_\-\-S\-Y\-S\-T\-M\-R\-\_\-\-E\-N\-A\-B\-L\-E}}
\index{P\-O\-R\-T\-\_\-\-S\-Y\-S\-T\-M\-R\-\_\-\-E\-N\-A\-B\-L\-E@{P\-O\-R\-T\-\_\-\-S\-Y\-S\-T\-M\-R\-\_\-\-E\-N\-A\-B\-L\-E}!CPU port interface@{C\-P\-U port interface}}
\paragraph[{P\-O\-R\-T\-\_\-\-S\-Y\-S\-T\-M\-R\-\_\-\-E\-N\-A\-B\-L\-E}]{\setlength{\rightskip}{0pt plus 5cm}\#define P\-O\-R\-T\-\_\-\-S\-Y\-S\-T\-M\-R\-\_\-\-E\-N\-A\-B\-L\-E(
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{group__template__cpu__intf_ga566d86ffb8459153b9bc95a7d9dfb8ca}


Enable the system timer. 

Responsibility\-:
\begin{DoxyItemize}
\item enable (run) the system timer counter 
\end{DoxyItemize}\hypertarget{group__template__cpu__intf_ga2a361d660165aff766184242c274fe40}{\index{C\-P\-U port interface@{C\-P\-U port interface}!P\-O\-R\-T\-\_\-\-S\-Y\-S\-T\-M\-R\-\_\-\-D\-I\-S\-A\-B\-L\-E@{P\-O\-R\-T\-\_\-\-S\-Y\-S\-T\-M\-R\-\_\-\-D\-I\-S\-A\-B\-L\-E}}
\index{P\-O\-R\-T\-\_\-\-S\-Y\-S\-T\-M\-R\-\_\-\-D\-I\-S\-A\-B\-L\-E@{P\-O\-R\-T\-\_\-\-S\-Y\-S\-T\-M\-R\-\_\-\-D\-I\-S\-A\-B\-L\-E}!CPU port interface@{C\-P\-U port interface}}
\paragraph[{P\-O\-R\-T\-\_\-\-S\-Y\-S\-T\-M\-R\-\_\-\-D\-I\-S\-A\-B\-L\-E}]{\setlength{\rightskip}{0pt plus 5cm}\#define P\-O\-R\-T\-\_\-\-S\-Y\-S\-T\-M\-R\-\_\-\-D\-I\-S\-A\-B\-L\-E(
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{group__template__cpu__intf_ga2a361d660165aff766184242c274fe40}


Disable the system timer. 

Responsibility\-:
\begin{DoxyItemize}
\item disable (stop) the system timer counter 
\end{DoxyItemize}\hypertarget{group__template__cpu__intf_ga3863363d274eeebcf2ad0a3887068e87}{\index{C\-P\-U port interface@{C\-P\-U port interface}!P\-O\-R\-T\-\_\-\-S\-Y\-S\-T\-M\-R\-\_\-\-I\-S\-R\-\_\-\-E\-N\-A\-B\-L\-E@{P\-O\-R\-T\-\_\-\-S\-Y\-S\-T\-M\-R\-\_\-\-I\-S\-R\-\_\-\-E\-N\-A\-B\-L\-E}}
\index{P\-O\-R\-T\-\_\-\-S\-Y\-S\-T\-M\-R\-\_\-\-I\-S\-R\-\_\-\-E\-N\-A\-B\-L\-E@{P\-O\-R\-T\-\_\-\-S\-Y\-S\-T\-M\-R\-\_\-\-I\-S\-R\-\_\-\-E\-N\-A\-B\-L\-E}!CPU port interface@{C\-P\-U port interface}}
\paragraph[{P\-O\-R\-T\-\_\-\-S\-Y\-S\-T\-M\-R\-\_\-\-I\-S\-R\-\_\-\-E\-N\-A\-B\-L\-E}]{\setlength{\rightskip}{0pt plus 5cm}\#define P\-O\-R\-T\-\_\-\-S\-Y\-S\-T\-M\-R\-\_\-\-I\-S\-R\-\_\-\-E\-N\-A\-B\-L\-E(
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{group__template__cpu__intf_ga3863363d274eeebcf2ad0a3887068e87}


Enable the system timer interrupt. 

Responsibility\-:
\begin{DoxyItemize}
\item allow system timer interrupt to occur 
\end{DoxyItemize}\hypertarget{group__template__cpu__intf_gac2054b84d008e800a13b0e25f93e2dd9}{\index{C\-P\-U port interface@{C\-P\-U port interface}!P\-O\-R\-T\-\_\-\-S\-Y\-S\-T\-M\-R\-\_\-\-I\-S\-R\-\_\-\-D\-I\-S\-A\-B\-L\-E@{P\-O\-R\-T\-\_\-\-S\-Y\-S\-T\-M\-R\-\_\-\-I\-S\-R\-\_\-\-D\-I\-S\-A\-B\-L\-E}}
\index{P\-O\-R\-T\-\_\-\-S\-Y\-S\-T\-M\-R\-\_\-\-I\-S\-R\-\_\-\-D\-I\-S\-A\-B\-L\-E@{P\-O\-R\-T\-\_\-\-S\-Y\-S\-T\-M\-R\-\_\-\-I\-S\-R\-\_\-\-D\-I\-S\-A\-B\-L\-E}!CPU port interface@{C\-P\-U port interface}}
\paragraph[{P\-O\-R\-T\-\_\-\-S\-Y\-S\-T\-M\-R\-\_\-\-I\-S\-R\-\_\-\-D\-I\-S\-A\-B\-L\-E}]{\setlength{\rightskip}{0pt plus 5cm}\#define P\-O\-R\-T\-\_\-\-S\-Y\-S\-T\-M\-R\-\_\-\-I\-S\-R\-\_\-\-D\-I\-S\-A\-B\-L\-E(
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{group__template__cpu__intf_gac2054b84d008e800a13b0e25f93e2dd9}


Disable the system timer interrupt. 

Responsibility\-:
\begin{DoxyItemize}
\item disallow system timer interrupt to occur 
\end{DoxyItemize}\hypertarget{group__template__cpu__intf_ga80d15a56d61c9d4e786e52006ff4ac43}{\index{C\-P\-U port interface@{C\-P\-U port interface}!P\-O\-R\-T\-\_\-\-C\-T\-X\-\_\-\-I\-N\-I\-T@{P\-O\-R\-T\-\_\-\-C\-T\-X\-\_\-\-I\-N\-I\-T}}
\index{P\-O\-R\-T\-\_\-\-C\-T\-X\-\_\-\-I\-N\-I\-T@{P\-O\-R\-T\-\_\-\-C\-T\-X\-\_\-\-I\-N\-I\-T}!CPU port interface@{C\-P\-U port interface}}
\paragraph[{P\-O\-R\-T\-\_\-\-C\-T\-X\-\_\-\-I\-N\-I\-T}]{\setlength{\rightskip}{0pt plus 5cm}\#define P\-O\-R\-T\-\_\-\-C\-T\-X\-\_\-\-I\-N\-I\-T(
\begin{DoxyParamCaption}
\item[{}]{stck, }
\item[{}]{stack\-Size, }
\item[{}]{thread, }
\item[{}]{arg}
\end{DoxyParamCaption}
)}}\label{group__template__cpu__intf_ga80d15a56d61c9d4e786e52006ff4ac43}


Initialize the thread context. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in,out}  & {\em stck} & Pointer to the allocated thread stck. The pointer points to the beginning of the memory as defined per C language. It's up to port function to adjust the pointer according to the stck type\-: full descending or full ascending one. \\
\hline
 & {\em stack\-Size} & The size of allocated stck in bytes. \\
\hline
\mbox{\tt in}  & {\em thread} & Pointer to the thread function. \\
\hline
\mbox{\tt in}  & {\em arg} & Argument that will be passed to thread function at the starting of execution. \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
The new top of stck after thread context initialization. 
\end{DoxyReturn}
\hypertarget{group__template__cpu__intf_ga50a3b72a7f2065922811f0d6dedda01a}{\index{C\-P\-U port interface@{C\-P\-U port interface}!P\-O\-R\-T\-\_\-\-C\-T\-X\-\_\-\-S\-W@{P\-O\-R\-T\-\_\-\-C\-T\-X\-\_\-\-S\-W}}
\index{P\-O\-R\-T\-\_\-\-C\-T\-X\-\_\-\-S\-W@{P\-O\-R\-T\-\_\-\-C\-T\-X\-\_\-\-S\-W}!CPU port interface@{C\-P\-U port interface}}
\paragraph[{P\-O\-R\-T\-\_\-\-C\-T\-X\-\_\-\-S\-W}]{\setlength{\rightskip}{0pt plus 5cm}\#define P\-O\-R\-T\-\_\-\-C\-T\-X\-\_\-\-S\-W(
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{group__template__cpu__intf_ga50a3b72a7f2065922811f0d6dedda01a}


Do the context switch -\/ invoked from A\-P\-I level. 

\hypertarget{group__template__cpu__intf_ga20bba8f9c5a2f38fd7c63b9d2320e511}{\index{C\-P\-U port interface@{C\-P\-U port interface}!P\-O\-R\-T\-\_\-\-C\-T\-X\-\_\-\-S\-W\-\_\-\-I\-S\-R@{P\-O\-R\-T\-\_\-\-C\-T\-X\-\_\-\-S\-W\-\_\-\-I\-S\-R}}
\index{P\-O\-R\-T\-\_\-\-C\-T\-X\-\_\-\-S\-W\-\_\-\-I\-S\-R@{P\-O\-R\-T\-\_\-\-C\-T\-X\-\_\-\-S\-W\-\_\-\-I\-S\-R}!CPU port interface@{C\-P\-U port interface}}
\paragraph[{P\-O\-R\-T\-\_\-\-C\-T\-X\-\_\-\-S\-W\-\_\-\-I\-S\-R}]{\setlength{\rightskip}{0pt plus 5cm}\#define P\-O\-R\-T\-\_\-\-C\-T\-X\-\_\-\-S\-W\-\_\-\-I\-S\-R(
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{group__template__cpu__intf_ga20bba8f9c5a2f38fd7c63b9d2320e511}


Do the context switch -\/ invoked from I\-S\-R level. 

\hypertarget{group__template__cpu__intf_ga07b918aaaed3cd0dbe89eb780ce3cb36}{\index{C\-P\-U port interface@{C\-P\-U port interface}!P\-O\-R\-T\-\_\-\-T\-H\-D\-\_\-\-S\-T\-A\-R\-T@{P\-O\-R\-T\-\_\-\-T\-H\-D\-\_\-\-S\-T\-A\-R\-T}}
\index{P\-O\-R\-T\-\_\-\-T\-H\-D\-\_\-\-S\-T\-A\-R\-T@{P\-O\-R\-T\-\_\-\-T\-H\-D\-\_\-\-S\-T\-A\-R\-T}!CPU port interface@{C\-P\-U port interface}}
\paragraph[{P\-O\-R\-T\-\_\-\-T\-H\-D\-\_\-\-S\-T\-A\-R\-T}]{\setlength{\rightskip}{0pt plus 5cm}\#define P\-O\-R\-T\-\_\-\-T\-H\-D\-\_\-\-S\-T\-A\-R\-T(
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{group__template__cpu__intf_ga07b918aaaed3cd0dbe89eb780ce3cb36}


Start the first thread. 

\hypertarget{group__template__cpu__intf_gacb3a46e89d327fbaf5c122fe23877b24}{\index{C\-P\-U port interface@{C\-P\-U port interface}!P\-O\-R\-T\-\_\-\-S\-T\-C\-K\-\_\-\-S\-I\-Z\-E@{P\-O\-R\-T\-\_\-\-S\-T\-C\-K\-\_\-\-S\-I\-Z\-E}}
\index{P\-O\-R\-T\-\_\-\-S\-T\-C\-K\-\_\-\-S\-I\-Z\-E@{P\-O\-R\-T\-\_\-\-S\-T\-C\-K\-\_\-\-S\-I\-Z\-E}!CPU port interface@{C\-P\-U port interface}}
\paragraph[{P\-O\-R\-T\-\_\-\-S\-T\-C\-K\-\_\-\-S\-I\-Z\-E}]{\setlength{\rightskip}{0pt plus 5cm}\#define P\-O\-R\-T\-\_\-\-S\-T\-C\-K\-\_\-\-S\-I\-Z\-E(
\begin{DoxyParamCaption}
\item[{}]{size}
\end{DoxyParamCaption}
)}}\label{group__template__cpu__intf_gacb3a46e89d327fbaf5c122fe23877b24}
{\bfseries Value\-:}
\begin{DoxyCode}
((((size + \hyperlink{group__template__cpu__intf_ga99f0219f12d2003e4e447fcaa06aa133}{PORT\_STCK\_MINSIZE\_VAL}) + (\textcolor{keyword}{sizeof}(\textcolor{keyword}{struct} \hyperlink{structportStck}{portStck}) /                
        \(\backslash\)
    sizeof(\hyperlink{group__template__cpu__intf_ga99980ab56ce9857e7380210d12e3d41f}{portReg\_T}))) - 1U) / (\textcolor{keyword}{sizeof}(\textcolor{keyword}{struct} \hyperlink{structportStck}{portStck})/\textcolor{keyword}{sizeof}(
      \hyperlink{group__template__cpu__intf_ga99980ab56ce9857e7380210d12e3d41f}{portReg\_T})))
\end{DoxyCode}


Calculate the stack size. 

This macro is used when specifying the size of thread stack. Responsibility\-:
\begin{DoxyItemize}
\item add to {\ttfamily size} the minimal stack size specified by \hyperlink{group__template__cpu__intf_ga99f0219f12d2003e4e447fcaa06aa133}{P\-O\-R\-T\-\_\-\-S\-T\-C\-K\-\_\-\-M\-I\-N\-S\-I\-Z\-E\-\_\-\-V\-A\-L}.
\item if it is needed by the port make sure the alignment is correct. 
\end{DoxyItemize}\hypertarget{group__template__cpu__intf_gad699a79233d442ae90a69c113e314542}{\index{C\-P\-U port interface@{C\-P\-U port interface}!P\-O\-R\-T\-\_\-\-C\-R\-I\-T\-I\-C\-A\-L\-\_\-\-E\-X\-I\-T\-\_\-\-S\-L\-E\-E\-P@{P\-O\-R\-T\-\_\-\-C\-R\-I\-T\-I\-C\-A\-L\-\_\-\-E\-X\-I\-T\-\_\-\-S\-L\-E\-E\-P}}
\index{P\-O\-R\-T\-\_\-\-C\-R\-I\-T\-I\-C\-A\-L\-\_\-\-E\-X\-I\-T\-\_\-\-S\-L\-E\-E\-P@{P\-O\-R\-T\-\_\-\-C\-R\-I\-T\-I\-C\-A\-L\-\_\-\-E\-X\-I\-T\-\_\-\-S\-L\-E\-E\-P}!CPU port interface@{C\-P\-U port interface}}
\paragraph[{P\-O\-R\-T\-\_\-\-C\-R\-I\-T\-I\-C\-A\-L\-\_\-\-E\-X\-I\-T\-\_\-\-S\-L\-E\-E\-P}]{\setlength{\rightskip}{0pt plus 5cm}\#define P\-O\-R\-T\-\_\-\-C\-R\-I\-T\-I\-C\-A\-L\-\_\-\-E\-X\-I\-T\-\_\-\-S\-L\-E\-E\-P(
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)~port\-Int\-Set\-Sleep\-Enter\-\_\-(int\-Status\-\_\-)}}\label{group__template__cpu__intf_gad699a79233d442ae90a69c113e314542}


Exit critical section and enter sleep state. 

\hypertarget{group__template__cpu__intf_gac9622b857ad35f73ae92a44a9d0f717c}{\index{C\-P\-U port interface@{C\-P\-U port interface}!P\-O\-R\-T\-\_\-\-I\-N\-I\-T\-\_\-\-E\-A\-R\-L\-Y@{P\-O\-R\-T\-\_\-\-I\-N\-I\-T\-\_\-\-E\-A\-R\-L\-Y}}
\index{P\-O\-R\-T\-\_\-\-I\-N\-I\-T\-\_\-\-E\-A\-R\-L\-Y@{P\-O\-R\-T\-\_\-\-I\-N\-I\-T\-\_\-\-E\-A\-R\-L\-Y}!CPU port interface@{C\-P\-U port interface}}
\paragraph[{P\-O\-R\-T\-\_\-\-I\-N\-I\-T\-\_\-\-E\-A\-R\-L\-Y}]{\setlength{\rightskip}{0pt plus 5cm}\#define P\-O\-R\-T\-\_\-\-I\-N\-I\-T\-\_\-\-E\-A\-R\-L\-Y(
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{group__template__cpu__intf_gac9622b857ad35f73ae92a44a9d0f717c}


Early port initialization. 

This macro will be called at early initialization stage from \hyperlink{group__kern__intf_ga9e9ff699d62d6035cd51121bb3140704}{es\-Kern\-Init()} function. It is called before any kernel data initialization. Usually this macro would be used to setup memory space, fill the memory with debug value or something similar. \hypertarget{group__template__cpu__intf_ga0da077bab2264b11c4107f0bef279b86}{\index{C\-P\-U port interface@{C\-P\-U port interface}!P\-O\-R\-T\-\_\-\-I\-N\-I\-T@{P\-O\-R\-T\-\_\-\-I\-N\-I\-T}}
\index{P\-O\-R\-T\-\_\-\-I\-N\-I\-T@{P\-O\-R\-T\-\_\-\-I\-N\-I\-T}!CPU port interface@{C\-P\-U port interface}}
\paragraph[{P\-O\-R\-T\-\_\-\-I\-N\-I\-T}]{\setlength{\rightskip}{0pt plus 5cm}\#define P\-O\-R\-T\-\_\-\-I\-N\-I\-T(
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{group__template__cpu__intf_ga0da077bab2264b11c4107f0bef279b86}


Port initialization. 

This macro will be called after kernel data structure initialization from \hyperlink{group__kern__intf_ga9e9ff699d62d6035cd51121bb3140704}{es\-Kern\-Init()} function. \hypertarget{group__template__cpu__intf_ga8bfda2e0a8029092d0377640ba228b6d}{\index{C\-P\-U port interface@{C\-P\-U port interface}!P\-O\-R\-T\-\_\-\-I\-N\-I\-T\-\_\-\-L\-A\-T\-E@{P\-O\-R\-T\-\_\-\-I\-N\-I\-T\-\_\-\-L\-A\-T\-E}}
\index{P\-O\-R\-T\-\_\-\-I\-N\-I\-T\-\_\-\-L\-A\-T\-E@{P\-O\-R\-T\-\_\-\-I\-N\-I\-T\-\_\-\-L\-A\-T\-E}!CPU port interface@{C\-P\-U port interface}}
\paragraph[{P\-O\-R\-T\-\_\-\-I\-N\-I\-T\-\_\-\-L\-A\-T\-E}]{\setlength{\rightskip}{0pt plus 5cm}\#define P\-O\-R\-T\-\_\-\-I\-N\-I\-T\-\_\-\-L\-A\-T\-E(
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{group__template__cpu__intf_ga8bfda2e0a8029092d0377640ba228b6d}


Late port initialization. 

This macro will be called just a moment before the multitasking is started. The macro is called from \hyperlink{group__kern__intf_ga0e7a0a6b9c02df58de0f98de0229a09d}{es\-Kern\-Start()} function. \hypertarget{group__template__cpu__intf_gab2a39b200d6e6806896ba45a9c3a9d1e}{\index{C\-P\-U port interface@{C\-P\-U port interface}!P\-O\-R\-T\-\_\-\-T\-E\-R\-M@{P\-O\-R\-T\-\_\-\-T\-E\-R\-M}}
\index{P\-O\-R\-T\-\_\-\-T\-E\-R\-M@{P\-O\-R\-T\-\_\-\-T\-E\-R\-M}!CPU port interface@{C\-P\-U port interface}}
\paragraph[{P\-O\-R\-T\-\_\-\-T\-E\-R\-M}]{\setlength{\rightskip}{0pt plus 5cm}\#define P\-O\-R\-T\-\_\-\-T\-E\-R\-M(
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{group__template__cpu__intf_gab2a39b200d6e6806896ba45a9c3a9d1e}


Terminate port. 

This macro will be called when there is a need to stop any further execution (example\-: an error occured and C\-P\-U needs to stop). 

\subsubsection{Typedef Documentation}
\hypertarget{group__template__cpu__intf_ga99980ab56ce9857e7380210d12e3d41f}{\index{C\-P\-U port interface@{C\-P\-U port interface}!port\-Reg\-\_\-\-T@{port\-Reg\-\_\-\-T}}
\index{port\-Reg\-\_\-\-T@{port\-Reg\-\_\-\-T}!CPU port interface@{C\-P\-U port interface}}
\paragraph[{port\-Reg\-\_\-\-T}]{\setlength{\rightskip}{0pt plus 5cm}typedef uint8\-\_\-t {\bf port\-Reg\-\_\-\-T}}}\label{group__template__cpu__intf_ga99980ab56ce9857e7380210d12e3d41f}


Data type which corresponds to the general purpose register. 

\hypertarget{group__template__cpu__intf_ga13cc91970e3e05fe4210440c068d3f4a}{\index{C\-P\-U port interface@{C\-P\-U port interface}!port\-Stck\-\_\-\-T@{port\-Stck\-\_\-\-T}}
\index{port\-Stck\-\_\-\-T@{port\-Stck\-\_\-\-T}!CPU port interface@{C\-P\-U port interface}}
\paragraph[{port\-Stck\-\_\-\-T}]{\setlength{\rightskip}{0pt plus 5cm}typedef struct {\bf port\-Stck} {\bf port\-Stck\-\_\-\-T}}}\label{group__template__cpu__intf_ga13cc91970e3e05fe4210440c068d3f4a}


Stack type. 



\subsubsection{Function Documentation}
\hypertarget{group__template__cpu__intf_ga548cbf806bfd34904f60a1f8db0ce965}{\index{C\-P\-U port interface@{C\-P\-U port interface}!port\-Find\-Last\-Set\-\_\-@{port\-Find\-Last\-Set\-\_\-}}
\index{port\-Find\-Last\-Set\-\_\-@{port\-Find\-Last\-Set\-\_\-}!CPU port interface@{C\-P\-U port interface}}
\paragraph[{port\-Find\-Last\-Set\-\_\-}]{\setlength{\rightskip}{0pt plus 5cm}uint\-\_\-fast8\-\_\-t port\-Find\-Last\-Set\-\_\- (
\begin{DoxyParamCaption}
\item[{{\bf port\-Reg\-\_\-\-T}}]{val}
\end{DoxyParamCaption}
)}}\label{group__template__cpu__intf_ga548cbf806bfd34904f60a1f8db0ce965}


Find last set bit in a word. 


\begin{DoxyParams}{Parameters}
{\em val} & Value which needs to be evaluated\\
\hline
\end{DoxyParams}
This function is used by the scheduler to efficiently determine the highest priority of thread ready for execution. For algorithm details see\-: \href{http://en.wikipedia.org/wiki/Find_first_set}{\tt http\-://en.\-wikipedia.\-org/wiki/\-Find\-\_\-first\-\_\-set}. \begin{DoxyReturn}{Returns}
The position of the last set bit in a word 
\end{DoxyReturn}
\hypertarget{group__template__cpu__intf_ga91a1dc500f743c80ec573148a99add67}{\index{C\-P\-U port interface@{C\-P\-U port interface}!port\-Ctx\-Init\-\_\-@{port\-Ctx\-Init\-\_\-}}
\index{port\-Ctx\-Init\-\_\-@{port\-Ctx\-Init\-\_\-}!CPU port interface@{C\-P\-U port interface}}
\paragraph[{port\-Ctx\-Init\-\_\-}]{\setlength{\rightskip}{0pt plus 5cm}void$\ast$ port\-Ctx\-Init\-\_\- (
\begin{DoxyParamCaption}
\item[{void $\ast$}]{stck, }
\item[{size\-\_\-t}]{stck\-Size, }
\item[{void($\ast$)(void $\ast$)}]{fn, }
\item[{void $\ast$}]{arg}
\end{DoxyParamCaption}
)}}\label{group__template__cpu__intf_ga91a1dc500f743c80ec573148a99add67}


Initialize the thread context. 


\begin{DoxyParams}{Parameters}
{\em stck} & Pointer to the allocated thread stck. The pointer points to the beginning of the memory as defined per C language. It's up to port function to adjust the pointer according to the stck type\-: full descending or full ascending one. \\
\hline
{\em stck\-Size} & The size of allocated stck in bytes. \\
\hline
{\em fn} & Pointer to the thread function. \\
\hline
{\em arg} & Argument that will be passed to thread function at the starting of execution. \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
The new top of stck after thread context initialization. 
\end{DoxyReturn}


\subsubsection{Variable Documentation}
\hypertarget{group__template__cpu__intf_ga76dd98d1f19ff5ce4b4e880dfcedadb9}{\index{C\-P\-U port interface@{C\-P\-U port interface}!g\-Port\-Isr\-Nesting\-\_\-@{g\-Port\-Isr\-Nesting\-\_\-}}
\index{g\-Port\-Isr\-Nesting\-\_\-@{g\-Port\-Isr\-Nesting\-\_\-}!CPU port interface@{C\-P\-U port interface}}
\paragraph[{g\-Port\-Isr\-Nesting\-\_\-}]{\setlength{\rightskip}{0pt plus 5cm}{\bf port\-Reg\-\_\-\-T} g\-Port\-Isr\-Nesting\-\_\-}}\label{group__template__cpu__intf_ga76dd98d1f19ff5ce4b4e880dfcedadb9}


Variable to keep track of I\-S\-R nesting. 

\hypertarget{group__template__cpu__intf_ga7c74d77135d5a694029ce4805f5dbc13}{\index{C\-P\-U port interface@{C\-P\-U port interface}!pwr2\-L\-K\-P@{pwr2\-L\-K\-P}}
\index{pwr2\-L\-K\-P@{pwr2\-L\-K\-P}!CPU port interface@{C\-P\-U port interface}}
\paragraph[{pwr2\-L\-K\-P}]{\setlength{\rightskip}{0pt plus 5cm}const P\-O\-R\-T\-\_\-\-C\-\_\-\-R\-O\-M {\bf port\-Reg\-\_\-\-T} pwr2\-L\-K\-P\mbox{[}{\bf P\-O\-R\-T\-\_\-\-D\-A\-T\-A\-\_\-\-W\-I\-D\-T\-H\-\_\-\-V\-A\-L}\mbox{]}}}\label{group__template__cpu__intf_ga7c74d77135d5a694029ce4805f5dbc13}


Look up table for\-: 2$^\wedge$n expression. 

This look up table can be used to accelerate the Logical Shift Left operations which are needed to set bits inside the priority bit map. In plain C this operation would be written as\-: {\ttfamily (1\-U $<$$<$ n)}, but in many 8-\/bit C\-P\-Us this operation can be lengthy. If there is a need for faster operation than this table can be used instead of the mentioned C code.

To use the look up table change \hyperlink{group__template__cpu__intf_ga4b938b55e8398b93969cfb7bc64177cd}{P\-O\-R\-T\-\_\-\-P\-W\-R2} macro implementation from\-: {\ttfamily (1\-U $<$$<$ (pwr))} to {\ttfamily pwr2\-L\-K\-P\mbox{[}pwr\mbox{]}} 