<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.5"/>
<title>eSolid - Real-Time Kernel: Scheduler</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="stylesheet.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="eSolid-logo_small.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">eSolid - Real-Time Kernel
   &#160;<span id="projectnumber">1.0BetaR01</span>
   </div>
   <div id="projectbrief">Event Based System</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.5 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="/"><span>Home&#160;page</span></a></li>
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Scheduler </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#sched_quantum">Quantum</a></li>
<li class="level1"><a href="#sched_thdL">Threads List</a></li>
<li class="level1"><a href="#sched_thdQ">Threads Queue</a><ul><li class="level2"><a href="#sched_rdyThdQ_simple">Simple Ready Threads Queue</a></li>
<li class="level2"><a href="#sched_rdyThdQ_complex">Complex Ready Threads Queue</a></li>
</ul>
</li>
<li class="level1"><a href="#sched_rdyThdQ">Ready Threads Queue</a></li>
</ul>
</div>
<div class="textblock"><p>About the scheduler and Ready Threads Queue</p>
<p><br/>
<br/>
<br/>
</p>
<h1><a class="anchor" id="sched_quantum"></a>
Quantum</h1>
<p>The period of time for which a thread is allowed to execute in a preemptive multi-threading system is generally called the time slice, or <code>quantum</code>. The scheduler is run once every quantum to choose the next thread for execution. If the quantum is too short then the scheduler overhead may become high.</p>
<p>An interrupt is used to allow the kernel to switch between threads when their quantum expires, effectively allowing the processor's time to be shared between a number of threads, giving the illusion that it is dealing with these threads concurrently.</p>
<h1><a class="anchor" id="sched_thdL"></a>
Threads List</h1>
<p>Each thread structure <a class="el" href="structesThd.html">esThd</a> contains Thread List structure <a class="el" href="structesThd_1_1thdL.html">esThd::thdL</a>. All threads of the same priority are linked together via <em>next</em> and <em>prev</em> members in <a class="el" href="structesThd_1_1thdL.html">esThd::thdL</a> structure. The first member of the structure is pointer <em>q</em> which points back to the Threads Queue structure (<a class="el" href="structesThdQ.html">esThdQ</a>) which contains the threads.</p>
<p>The list is organized as <b>circular doubly linked list</b>, which means that <em>tail</em> and <em>head</em> nodes are linked together just like every other node in the list. This provides easy and efficient traversal of the list.</p>
<div class="image">
<img src="thdL.png" alt="thdL.png"/>
<div class="caption">
Detailed view of Threads List (sentinel.next pointers not shown)</div></div>
<p>Each sentinel of a list has two pointers, <em>head</em> and <em>next</em>. Pointer sentinel.head* always points to the first entry of the list which is called head*. Every new thread is added at the <em>tail</em> of the list which is essentialy just after the node <em>head</em>. When a first thread is added to the list the pointer sentinel.next* points to the thread, too. When the list is rotated using function <a class="el" href="group__kern__intf.html#gae365b14292f1496a90d876baec84fb4e" title="Fetch the next thread and rotate thread linked list. ">esThdQFetchRotateI()</a> the pointer <em>sentinel.next</em> is advanced forward and points to the next thread in list.</p>
<div class="image">
<img src="thdL-rotate.png" alt="thdL-rotate.png"/>
<div class="caption">
Detailed view of the sentinel and linked list</div></div>
<h1><a class="anchor" id="sched_thdQ"></a>
Threads Queue</h1>
<p>Based on the number of configured priority levels (see <a class="el" href="group__template__kern__cfg.html#ga56bd89fe76f7fe22f3d8805bc3c68892">CFG_SCHED_PRIO_LVL</a>) and on the number of data register bits (see <a class="el" href="group__template__cpu__intf.html#gac4d9e19c50315dec7721d4bc4d6b0605">PORT_DATA_WIDTH_VAL</a>) of the used CPU, two configurations are possible:</p>
<ul>
<li>Simple Ready Threads Queue</li>
<li>Complex Ready Threads Queue</li>
</ul>
<p>Simple Ready Threads Queue configuration is used when the number of configured priority levels is lower or equal to the number of bits in general purpose data register. For example if application is using 9 priority levels on 32-bit CPU than simple Ready Threads Queue configuration is used. In contrast, when using 9 priority levels on an 8-bit CPU than the kernel is forced to use the Complex Ready Threads Queue configuration since 8-bit register cannot carry 9 bits of data.</p>
<h2><a class="anchor" id="sched_rdyThdQ_simple"></a>
Simple Ready Threads Queue</h2>
<p>Each bit in <code>bit[0]</code> variable represents one priority level. The number of bits used in this variable depends on <a class="el" href="group__template__kern__cfg.html#ga56bd89fe76f7fe22f3d8805bc3c68892">CFG_SCHED_PRIO_LVL</a> value. If a bit at <code>Nth</code> position is set then there is a thread inserted in Thread List at <code>Nth</code> priority level.</p>
<p><br/>
</p>
<div class="image">
<img src="thdQ-simple.png" alt="thdQ-simple.png"/>
<div class="caption">
Ready Threads Queue - low number of priority levels</div></div>
<dl class="section user"><dt>Inserting a thread</dt><dd>The process of a thread insertion into a thread queue can be described using the following pseudo-code: <div class="fragment"><div class="line"><span class="keyword">function</span> insert(thread)</div>
<div class="line">    priority := thread.priority                             <span class="preprocessor"># Get the priority of the thread</span></div>
<div class="line"><span class="preprocessor"></span>    </div>
<div class="line">    <span class="keywordflow">if</span> (grp[priority].head == NULL)                         # If <span class="keyword">this</span> priority level has a list</div>
<div class="line">        grp[priority].head := thread                        # Create a list with <span class="keyword">this</span> thread as head</div>
<div class="line">        grp[priority].next := thread</div>
<div class="line">        bitIndx := 2^priority                               # bitIndx equals to 2 raised to the power of priority</div>
<div class="line">        bit[0]  := bit[0] or bitIndx                        # Set the calculated bit in Bit Map</div>
<div class="line">    <span class="keywordflow">else</span></div>
<div class="line">        listInsertAtTail(grp[priority].head, thread)        <span class="preprocessor"># Add thread at tail of existing list</span></div>
<div class="line"><span class="preprocessor"></span>    end <span class="keywordflow">if</span></div>
<div class="line">end <span class="keyword">function</span></div>
</div><!-- fragment --></dd></dl>
<dl class="section user"><dt>Removing a thread</dt><dd>The process of a thread removal can be described with the following pseudo-code: <div class="fragment"><div class="line"><span class="keyword">function</span> <span class="keyword">remove</span>(thread)</div>
<div class="line">    priority := thread.priority                             # Get the priority of the thread</div>
<div class="line">    </div>
<div class="line">    if (listIsEntryLast(thread))                            # In <span class="keywordflow">case</span> we are removing the last entry</div>
<div class="line">        grp[priority].head := NULL                          # List is deleted</div>
<div class="line">        bitIndx := 2^priority                               # bitIndx equals to 2 raised to the power of priority</div>
<div class="line">        bit[0]  := bit[0] and not bitIndx                   # Clear the calculated bit in Bit Map</div>
<div class="line">    <span class="keywordflow">else</span></div>
<div class="line">        listRemove(thread)                                  # Remove the thread from list</div>
<div class="line">    end <span class="keywordflow">if</span></div>
<div class="line">end <span class="keyword">function</span></div>
</div><!-- fragment --></dd></dl>
<dl class="section user"><dt>Fetching the highest priority thread</dt><dd>The process of fetching the highest priority thread is inverse function of <code>2^priority</code> which was used in <code>insert()</code> function: <div class="fragment"><div class="line"><span class="keyword">function</span> fetch()</div>
<div class="line">    priority := log2(bit[0])                                <span class="preprocessor"># Find Last Set bit position in bit[0]</span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line">    <span class="keywordflow">return</span> grp[priority]</div>
<div class="line">end <span class="keyword">function</span></div>
</div><!-- fragment --></dd></dl>
<dl class="section user"><dt>Rotating the threads queue</dt><dd>The process can be described with the following algorithm: <div class="fragment"><div class="line"><span class="keyword">function</span> rotate()</div>
<div class="line">    priority := log2(bit[0])                                <span class="preprocessor"># Find Last Set bit position in bit[0]</span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line">    grp[priority].next := grp[priority].next.next</div>
<div class="line">    </div>
<div class="line">    <span class="keywordflow">return</span> grp[priority].next</div>
<div class="line">end <span class="keyword">function</span></div>
</div><!-- fragment --> </dd></dl>
<h2><a class="anchor" id="sched_rdyThdQ_complex"></a>
Complex Ready Threads Queue</h2>
<div class="image">
<img src="thdQ-complex.png" alt="thdQ-complex.png"/>
<div class="caption">
Ready Threads Queue - high number of priority levels</div></div>
<h1><a class="anchor" id="sched_rdyThdQ"></a>
Ready Threads Queue</h1>
<p>Ready Threads Queue holds threads that are ready for execution. </p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.5
</small></address>
</body>
</html>
